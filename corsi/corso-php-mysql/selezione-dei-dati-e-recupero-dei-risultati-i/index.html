<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Selezione dei dati e recupero dei risultati - I - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Leggere i dati di una tabella MySQL con PHP. Eseguire una SELECT con PHP e MySQL."><meta property="og:title" content="Selezione dei dati e recupero dei risultati - I"><meta property="og:description" content="Leggere i dati di una tabella MySQL con PHP. Eseguire una SELECT con PHP e MySQL."><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/corsi/corso-php-mysql/selezione-dei-dati-e-recupero-dei-risultati-i/"><meta property="article:section" content="corsi"><meta property="article:published_time" content="2006-08-26T18:02:12+00:00"><meta property="article:modified_time" content="2006-08-26T18:02:12+00:00"><meta itemprop=name content="Selezione dei dati e recupero dei risultati - I"><meta itemprop=description content="Leggere i dati di una tabella MySQL con PHP. Eseguire una SELECT con PHP e MySQL."><meta itemprop=datePublished content="2006-08-26T18:02:12+00:00"><meta itemprop=dateModified content="2006-08-26T18:02:12+00:00"><meta itemprop=wordCount content="1397"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Selezione dei dati e recupero dei risultati - I"><meta name=twitter:description content="Leggere i dati di una tabella MySQL con PHP. Eseguire una SELECT con PHP e MySQL."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Selezione dei dati e recupero dei risultati - I</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2006-08-26T18:02:12Z>26 August 2006</time></div></div></header><div class="content post__content clearfix"><p>Adesso che sappiamo inserire dei dati in una tabella MySQL vediamo come poterli recuperare e mostrare all&rsquo;utente. Si tratta ancora una volta di eseguire una query, in particolare bisogna lanciare una SELECT, ma ora dobbiamo occuparci anche di un altro compito, ovvero il recupero del <strong>set di risultati</strong> (<strong>result set</strong>) ottenuto.</p><p>Come visto in precedenza la funzione mysql_query() ci permette di inviare una query al server MySQL. Se ad esempio inviando una query del tipo:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> id, nome <span style=color:#66d9ef>FROM</span> utenti
</code></pre></div><p>chiediamo al server i dati presenti nei campi &ldquo;id&rdquo; e &ldquo;nome&rdquo; della tabella &ldquo;utenti&rdquo;. Ma dove vengono inviati questi dati? Il comportamento della funzione mysql_query() prevede che tutti i record ottenuti vengano inviati immediatamente da MySQL a PHP. Quest&rsquo;ultimo li conserva nella sua memoria (in un &ldquo;buffer&rdquo;, da cui il nome <em>buffered query</em>) ma non li rende direttamente disponibili allo script. In pratica mysql_query() non restituisce i record estratti dal database, ma ci consegna una semplice &ldquo;ricevuta&rdquo; che prende il nome di &ldquo;MySQL result resource&rdquo;. Per prelevare i dati è necessaria un&rsquo;ulteriore procedura detta <strong>fetch</strong>. Grazie alla &ldquo;ricevuta&rdquo; fornitaci da mysql_query() possiamo chiamare una delle funzioni di fetch e ottenere finalmente, un record alla volta, i dati appartenenti al set di risultati.</p><p>Ci sono diverse funzioni di fetch disponibili, che si distinguono per la modalità con cui restituiscono il record estratto:</p><ul><li><strong>mysql_fetch_row()</strong> - restituisce un record del set di risultati all&rsquo;interno di un array con indici numerici;</li><li><strong>mysql_fetch_assoc()</strong> - restituisce un record del set di risultati all&rsquo;interno di un array associativo;</li><li><strong>mysql_fetch_object()</strong> - restituisce un record del set di risultati all&rsquo;interno di un oggetto con proprietà che corrispondono ai campi del record.</li></ul><p>Disponibile inoltre la funzione <strong>mysql_fetch_array()</strong> che cambia il suo comportamento in funzione del secondo parametro passatogli:</p><ul><li>mysql_fetch_array($ricevuta, <strong>MYSQL_ASSOC</strong>)
restituisce un record del set di risultati all&rsquo;interno di un array associativo. Equivalente a mysql_fetch_assoc()</li><li>mysql_fetch_array($ricevuta, <strong>MYSQL_NUM</strong>)
restituisce un record del set di risultati all&rsquo;interno di un array con indici numerici - Equivalente a mysql_fetch_row()</li><li>mysql_fetch_array($ricevuta, <strong>MYSQL_BOTH</strong>)
restituisce un record del set di risultati all&rsquo;interno di un array con indici numerici e associativi - Comportamento di default in caso di assenza del secondo parametro.</li></ul><p>Se si vogliono recuperare tutti i record restituiti da una query le funzioni di fetch devono essere richiamata tante volte quanti sono i record. Queste funzioni infatti restituiscono, in formati diversi, solo un record e non tutto il set di risultati. Ad ogni nuova esecuzione, queste funzioni estraggono il record successivo, fino all&rsquo;ultimo. Raggiunto l&rsquo;ultimo record un&rsquo;ulteriore esecuzione di queste funzioni restituisce il valore FALSE, segnalando quindi che non ci sono più dati da prelevare.</p><p>Estratti tutti i risultati non bisogna dimenticare che PHP sta conservando ancora nella sua memoria tutti i record restituiti dalla query. E' quindi possibile (e consigliato) liberare tale memoria, attraverso la funzione <strong>mysql_free_result()</strong>.</p><p>Tenendo presente questo comportamento delle istruzioni di fetch è facile realizzare un ciclo WHILE che ne iteri l&rsquo;esecuzione fino all&rsquo;estrazione completa dei record. I seguenti esempi mostrano proprio questa tecnica, applicata alle diverse funzioni di fetch.</p><p><strong>- mysql_fetch_row</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$ricevuta <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>(<span style=color:#e6db74>&#34;SELECT id, nome FROM utenti &#34;</span>);

<span style=color:#66d9ef>while</span> ($row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_row</span>($ricevuta)) {
   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;ID: &#39;</span>, $row[<span style=color:#ae81ff>0</span>] , <span style=color:#e6db74>&#39; Nome: &#39;</span>, $row[<span style=color:#ae81ff>1</span>] , <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
}
</code></pre></div><p><strong>- mysql_fetch_assoc</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$ricevuta <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>(<span style=color:#e6db74>&#34;SELECT id, nome FROM utenti &#34;</span>);

<span style=color:#66d9ef>while</span> ($row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_assoc</span>($ricevuta)) {
   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;ID: &#39;</span>, $row[<span style=color:#e6db74>&#39;id&#39;</span>] , <span style=color:#e6db74>&#39; Nome: &#39;</span>, $row[<span style=color:#e6db74>&#39;nome&#39;</span>] , <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
}
</code></pre></div><p><strong>- mysql_fetch_object</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$ricevuta <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>(<span style=color:#e6db74>&#34;SELECT id, nome FROM utenti &#34;</span>);

<span style=color:#66d9ef>while</span> ($obj <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_object</span>($ricevuta)) {
   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;ID: &#39;</span>, $obj<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>id</span> , <span style=color:#e6db74>&#39; Nome: &#39;</span>, $obj<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>nome</span> , <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
}
</code></pre></div><p><strong>- mysql_fetch_array</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$ricevuta <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>(<span style=color:#e6db74>&#34;SELECT id, nome FROM utenti &#34;</span>);

<span style=color:#66d9ef>while</span> ($row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_array</span>($ricevuta, <span style=color:#a6e22e>MYSQL_BOTH</span>)) {
   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;ID: &#39;</span>, $row[<span style=color:#ae81ff>0</span>] , <span style=color:#e6db74>&#39; Nome: &#39;</span>, $row[<span style=color:#e6db74>&#39;nome&#39;</span>] , <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
}
</code></pre></div><p>Le istruzioni di fetch mostrate estraggono un record dal set dei risultati. Non è possibile specificare quale record estrarre poiché questi sono restituiti in sequenza, dal primo all&rsquo;ultimo. PHP infatti tiene traccia della posizione corrente all&rsquo;interno del set di risultati attraverso un puntatore, ovvero un indice che, supponendo che la query abbia prelevato dal database N record, va da 0 (il primo) a N-1 (l&rsquo;ultimo).</p><p>Effettuata una query questo puntatore è inizializzato da PHP a 0 e viene incrementato di una unità ad ogni esecuzione di una funzione di fetch. Questo spiega il funzionamento dei cicli WHILE degli esempi precedenti.</p><p>Normalmente non è necessario agire su questo puntatore, poiché quasi sempre siamo interessati ad estrarre tutti i record provenienti dalla query, nell&rsquo;ordine con cui sono stati prodotti ed inviati da MySQL. Se però volessimo prelevare solo alcuni record allora possiamo utilizzare la funzione <strong>mysql_data_seek()</strong> con cui è possibile spostarsi all&rsquo;interno del set di risultati. Nel seguente esempio verrà estratto solo il primo e l&rsquo;ultimo record dal set dei risultati:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$ricevuta <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>(<span style=color:#e6db74>&#34;SELECT nome FROM utenti ORDER BY nome&#34;</span>);

$row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_assoc</span>($ricevuta);
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Primo nome: &#39;</span>, $row[<span style=color:#e6db74>&#39;nome&#39;</span>], <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;

$numero_record <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_num_rows</span>($ricevuta);
<span style=color:#a6e22e>mysql_data_seek</span>($ricevuta, $numero_record <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);

$row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_assoc</span>($ricevuta);
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Ultimo nome: &#39;</span>, $row[<span style=color:#e6db74>&#39;nome&#39;</span>], <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</code></pre></div><p>Analizziamo nel dettaglio il funzionamento del precedente script:</p><ul><li>Per prima cosa viene lanciata la query</li><li>Con la funzione mysql_fetch_assoc() otteniamo un record del set di risultati. Si tratta ovviamente del primo record, poiché il puntatore interno al set di risultati è inizialmente a 0</li><li>Per sapere quanti record $numero_record sono stati estratti impieghiamo la funzione <strong>mysql_num_rows()</strong></li><li>Spostiamo il puntatore del set di risultati all&rsquo;ultimo record ($numero_record - 1) con mysql_data_seek()</li><li>Con la funzione mysql_fetch_assoc otteniamo un ulteriore record del set di risultati. Si tratta dell&rsquo;ultimo record presente.</li></ul><p>Prima di concludere con le istruzioni di fetch è doveroso citare <strong>mysql_result()</strong>. A differenza delle altre funzioni di fetch che prelevano un intero record dal set di risultati, mysql_result() permette di ottenere solo un campo di un particolare record (una sola cella). Ecco un esempio del suo funzionamento:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$ricevuta <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>(<span style=color:#e6db74>&#34;SELECT id, nome FROM utenti ORDER BY id&#34;</span>);

<span style=color:#75715e>// mostra il nome del TERZO record restituito dalla query
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>mysql_result</span>($ricevuta, <span style=color:#ae81ff>2</span>,<span style=color:#e6db74>&#39;nome&#39;</span>);
</code></pre></div><h3 id=query-buffered-e-unbuffered>Query buffered e unbuffered</h3><p>Come accennato all&rsquo;inizio della lezione, questo modo di effettuare una query è detto <em>buffered</em> perché è il PHP a conservare nella sua memoria tutti i record restituiti, accessibili allo script attraverso la procedura di fetch. E' possibile però lasciare a MySQL il compito di conservare i record e prelevarli, uno ad uno, direttamente con le istruzioni di fetch. Questa modalità è detta <em>unbuffered</em>. Per effettuare una query in modalità unbuffered basta usare la funzione <strong>mysql_unbuffered_query()</strong> al posto della classica mysql_query().</p><p>A questo punto è lecito chiedersi il motivo della presenza di due approcci distinti per la gestione del set di risultati, considerato che lo scopo ultimo rimane comunque l&rsquo;estrazione dei dati dal database. Vediamo i pro ed i contro delle due tecniche:</p><ul><li>con le query buffered i dati vengono conservati da PHP che ha quindi la possibilità di poterli manipolare più agevolmente. E' infatti possibile utilizzare mysql_data_seek() per spostarsi liberamente all&rsquo;interno dei risultati. Inoltre è possibile richiamare mysql_num_rows() per sapere subito quante righe sono state restituite dall&rsquo;ultima query. mysql_data_seek() e mysql_num_rows() non sono disponibili per una unbuffered query.</li><li>Liberando immediatamente MySQL, le query buffered permettono al server di sbloccare subito i dati coinvolti dalla query in modo che altri processi (altri utenti) possano accedervi. Se ad esempio uno script legge un dato dal database, questo stesso dato non potrà essere modificato da un altro script fino a che non si chiude il set di risultati (mysql_free_result).</li><li>Le query buffered costringono il PHP a conservare nella sua memoria tutto il set di risultati e questo compito può risultare oneroso se vengono gestite grosse quantità di dati.</li><li>Le query buffered constringono lo script a sospendere la sua esecuzione fino a quando tutti i dati non hanno raggiunto il PHP, quindi il primo risultato è disponibile solo quando tutti i risultati sono estratti da MySQL, inviati e memorizzati dal PHP.</li><li>Con una query unbuffered i risultati sono accessibili al PHP esclusivamente in maniera sequenziale ma sono disponibili non appena MySQL inizia a restituirli.</li><li>Le query unbuffered hanno un ulteriore inconveniente. Poiché l&rsquo;interazione tra PHP e MySQL non si conclude con l&rsquo;invio della query ma continua per tutta la fase di fetch, per lanciare una nuova query è necessario prima prelevare tutti i risultati della precedente oppure chiudere il set di risultati (mysql_free_result).</li></ul><p>E' chiaro quindi che non esiste una soluzione migliore rispetto all&rsquo;altra. Anche se vengono privilegiate le buffered query perché permettono una migliore gestione del set di risultati, in casi di alto carico dell&rsquo;applicazione e per grossi volumi di dati coinvolti, potrebbe convenire impiegare le unbuffered query.</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/corsi/corso-php-mysql/inserimento-dei-dati/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Inserimento dei dati</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/corsi/corso-php-mysql/selezione-dei-dati-e-recupero-dei-risultati-ii/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Selezione dei dati e recupero dei risultati - II</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>