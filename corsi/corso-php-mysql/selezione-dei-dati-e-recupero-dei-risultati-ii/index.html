<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Selezione dei dati e recupero dei risultati - II - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Script PHP per la lettura dei dati di una tabella MySQL"><meta property="og:title" content="Selezione dei dati e recupero dei risultati - II"><meta property="og:description" content="Script PHP per la lettura dei dati di una tabella MySQL"><meta property="og:type" content="article"><meta property="og:url" content="https://www.giovannitomasicchio.it/corsi/corso-php-mysql/selezione-dei-dati-e-recupero-dei-risultati-ii/"><meta property="article:section" content="corsi"><meta property="article:published_time" content="2006-08-26T18:02:31+00:00"><meta property="article:modified_time" content="2006-08-26T18:02:31+00:00"><meta itemprop=name content="Selezione dei dati e recupero dei risultati - II"><meta itemprop=description content="Script PHP per la lettura dei dati di una tabella MySQL"><meta itemprop=datePublished content="2006-08-26T18:02:31+00:00"><meta itemprop=dateModified content="2006-08-26T18:02:31+00:00"><meta itemprop=wordCount content="560"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Selezione dei dati e recupero dei risultati - II"><meta name=twitter:description content="Script PHP per la lettura dei dati di una tabella MySQL"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Selezione dei dati e recupero dei risultati - II</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2006-08-26T18:02:31Z>26 August 2006</time></div></div></header><div class="content post__content clearfix"><p>Con gli esempi della nella precedente lezione abbiamo visto come recuperare dei dati da un database MySQL impiegando le diverse procedure di fetch dei risultati di una query. Nella maggior parte dei casi questi dati devono poi essere mostrati all&rsquo;utente, all&rsquo;interno di una pagina (X)HTML, per cui è necessario prestare attenzione ad ulteriori aspetti, non meno importanti, legati sia a questioni estetiche e di rispetto degli standard, sia alla sicurezza dello script. In particolare è importante tener presente che:</p><ul><li>alcuni caratteri non possono essere inseriti così come si presentano all&rsquo;interno di una pagina HTML ma è necessario prima convertirli nelle relative &ldquo;enità HTML&rdquo;. Questa conversione risolve seri problemi di sicurezza che si possono verificare se tali stringhe sono state precedentemente inserite nel database da un utente.</li><li>gli &ldquo;a capo&rdquo; presenti in un testo non hanno alcun effettuo sulla formattazione di una pagina HTML. Devono pertanto essere convertiti negli &ldquo;a capo&rdquo; dell' HTML, ovvero nei tag &lt;br> .</li><li>in alcune circostanze, ad esempio quando si inseriscono contenuti in una tabella HTML, bisogna sostituire le stringhe vuote con qualcosa di trasparente, ad esempio l&rsquo;entità &amp;nbsp;</li><li>molte informazioni memorizzate nel DB hanno una qualche forma di codifica che va correttamente trattata. Ad esempio il campo &ldquo;attivita&rdquo; della tabella &ldquo;utenti&rdquo; codifica con i numeri da 0 a 3 le attività &ldquo;non dichiarata&rdquo;,&ldquo;studente&rdquo;, &ldquo;impiegato&rdquo;, &ldquo;disoccupato&rdquo;. All&rsquo;utente andrà mostrata l&rsquo;attività, non il numero che la rappresenta.</li></ul><p>Vediamo quindi come tradurre in codice le precedenti osservazioni, considerando uno script che mostra i dati contenuti nella tabella &ldquo;utenti&rdquo; all&rsquo;interno di una tabella HTML.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#75715e>// richiamo il file di configurazione
</span><span style=color:#75715e></span><span style=color:#66d9ef>require</span> <span style=color:#e6db74>&#39;config.php&#39;</span>;

<span style=color:#75715e>// richiamo lo script responsabile della connessione a MySQL
</span><span style=color:#75715e></span><span style=color:#66d9ef>require</span> <span style=color:#e6db74>&#39;connect.php&#39;</span>;

<span style=color:#75715e>// preparo la query
</span><span style=color:#75715e></span>$query <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT nome,email,sesso,newsletter,attivita,messaggio FROM utenti&#34;</span>;

<span style=color:#75715e>// invio la query
</span><span style=color:#75715e></span>$result <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>($query);

<span style=color:#75715e>// controllo l&#39;esito
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$result) {
   <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Errore nella query </span><span style=color:#e6db74>$query</span><span style=color:#e6db74>: &#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>mysql_error</span>());
}

$sesso_arr <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;&amp;nbsp;&#39;</span>,<span style=color:#e6db74>&#39;M&#39;</span>,<span style=color:#e6db74>&#39;F&#39;</span>);
$attivita_arr <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;&amp;nbsp;&#39;</span>,<span style=color:#e6db74>&#39;studente&#39;</span>,<span style=color:#e6db74>&#39;lavoratore&#39;</span>,<span style=color:#e6db74>&#39;disoccupato&#39;</span>);

<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;
</span><span style=color:#e6db74>&lt;table border=&#34;1&#34;&gt;
</span><span style=color:#e6db74>   &lt;tr&gt;
</span><span style=color:#e6db74>       &lt;th&gt;Nome&lt;/th&gt;
</span><span style=color:#e6db74>       &lt;th&gt;Email&lt;/th&gt;
</span><span style=color:#e6db74>       &lt;th&gt;Sesso&lt;/th&gt;
</span><span style=color:#e6db74>       &lt;th&gt;Newsletter&lt;/th&gt;
</span><span style=color:#e6db74>       &lt;th&gt;Attivit&amp;agrave;&lt;/th&gt;
</span><span style=color:#e6db74>       &lt;th&gt;Messaggio&lt;/th&gt;
</span><span style=color:#e6db74>   &lt;/tr&gt;&#39;</span>;

<span style=color:#66d9ef>while</span> ($row <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_fetch_assoc</span>($result)) {
   $nome      <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlentities</span>($row[<span style=color:#e6db74>&#39;nome&#39;</span>]);
   $email     <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlentities</span>($row[<span style=color:#e6db74>&#39;email&#39;</span>]);
   $messaggio <span style=color:#f92672>=</span> <span style=color:#a6e22e>htmlentities</span>($row[<span style=color:#e6db74>&#39;messaggio&#39;</span>]);
   $messaggio <span style=color:#f92672>=</span> <span style=color:#a6e22e>nl2br</span>($messaggio);

   <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$email)     $email <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&amp;nbsp;&#39;</span>;
   <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$messaggio) $messaggio <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&amp;nbsp;&#39;</span>;

   $sesso <span style=color:#f92672>=</span> $sesso_arr[$row[<span style=color:#e6db74>&#39;sesso&#39;</span>]];
   $newsletter <span style=color:#f92672>=</span> $row[<span style=color:#e6db74>&#39;newsletter&#39;</span>] <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;Si&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;No&#39;</span>;
   $attivita <span style=color:#f92672>=</span> $attivita_arr[$row[<span style=color:#e6db74>&#39;attivita&#39;</span>]];

   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;tr&gt;
</span><span style=color:#e6db74>           &lt;td&gt;</span><span style=color:#e6db74>$nome</span><span style=color:#e6db74>&lt;/td&gt;
</span><span style=color:#e6db74>           &lt;td&gt;</span><span style=color:#e6db74>$email</span><span style=color:#e6db74>&lt;/td&gt;
</span><span style=color:#e6db74>           &lt;td&gt;</span><span style=color:#e6db74>$sesso</span><span style=color:#e6db74>&lt;/td&gt;
</span><span style=color:#e6db74>           &lt;td&gt;</span><span style=color:#e6db74>$newsletter</span><span style=color:#e6db74>&lt;/td&gt;
</span><span style=color:#e6db74>           &lt;td&gt;</span><span style=color:#e6db74>$attivita</span><span style=color:#e6db74>&lt;/td&gt;
</span><span style=color:#e6db74>           &lt;td&gt;</span><span style=color:#e6db74>$messaggio</span><span style=color:#e6db74>&lt;/td&gt;
</span><span style=color:#e6db74>       &lt;/tr&gt;&#34;</span>;
}

<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;&lt;/table&gt;&#39;</span>;

<span style=color:#75715e>// libero la memoria di PHP occupata dai record estratti con la SELECT
</span><span style=color:#75715e></span><span style=color:#a6e22e>mysql_free_result</span>($result);

<span style=color:#75715e>// chiudo la connessione a MySQL
</span><span style=color:#75715e></span><span style=color:#a6e22e>mysql_close</span>();
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Le righe 34-36 provvedono alla conversione dei caratteri speciali con le relative entità HTML attraverso l&rsquo;istruzione <strong>htmlentities()</strong>. La corretta visualizzazione degli &ldquo;a capo&rdquo; è invece affidata alla funzione <strong>nl2br()</strong> (riga 37)</p><p>La decodifica delle informazioni del sesso e dell&rsquo;attività avviene attraverso l&rsquo;uso degli array $sesso_arr e $attivita_arr. Per evitare la creazione di celle vuote abbiamo utilizzato l&rsquo;entità &amp;nbsp; sia negli array $sesso_arr e $attivita_arr (righe 19-20), sia come alternativa alla stringa vuota per le variabili $email e $messaggio (righe 39-40).</p><p>Al di là delle precauzioni prese in questo script di esempio, ciò che è doveroso sottolineare è l&rsquo;importanza di una corretta valutazione del formato di destinazione dei dati prelevati dal database ((X)HTML, PDF, email, file di testo, XML, ecc.). Lo script PHP infatti ha il compito di fare da tramite tra il database e l&rsquo;output finale pertanto non si può limitare ad estrarre i record dalla tabella ma deve effettuare un&rsquo;adeguata conversione degli stessi, operazione che se sottovalutato può condurre a seri problemi di sicurezza.</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/corsi/corso-php-mysql/selezione-dei-dati-e-recupero-dei-risultati-i/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Selezione dei dati e recupero dei risultati - I</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/corsi/corso-php-mysql/cancellazione-dei-dati/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Cancellazione dei dati</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//giovannitomasicchio-it.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>