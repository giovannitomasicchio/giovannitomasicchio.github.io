<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Connessione a MySQL e selezione del DB - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Connessione con PHP al server MySQL e selezione del database."><meta property="og:title" content="Connessione a MySQL e selezione del DB"><meta property="og:description" content="Connessione con PHP al server MySQL e selezione del database."><meta property="og:type" content="article"><meta property="og:url" content="https://www.giovannitomasicchio.it/corsi/corso-php-mysql/connessione-a-mysql-e-selezione-del-db/"><meta property="article:section" content="corsi"><meta property="article:published_time" content="2006-08-26T18:00:49+00:00"><meta property="article:modified_time" content="2006-08-26T18:00:49+00:00"><meta itemprop=name content="Connessione a MySQL e selezione del DB"><meta itemprop=description content="Connessione con PHP al server MySQL e selezione del database."><meta itemprop=datePublished content="2006-08-26T18:00:49+00:00"><meta itemprop=dateModified content="2006-08-26T18:00:49+00:00"><meta itemprop=wordCount content="1124"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Connessione a MySQL e selezione del DB"><meta name=twitter:description content="Connessione con PHP al server MySQL e selezione del database."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Connessione a MySQL e selezione del DB</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2006-08-26T18:00:49Z>26 August 2006</time></div></div></header><div class="content post__content clearfix"><p>Vediamo ora come realizzare un semplice script PHP in grado di connettersi ad un server MySQL. La connessione avviene grazie ala funzione <strong>mysql_connect()</strong>. I dati necessari alla connessione sono:</p><ul><li><strong>indirizzo del server</strong>: bisogna specificare su quale computer è in esecuzione il server MySQL. Nella maggior parte dei casi MySQL gira sulla stessa macchina in cui è in funzione il server web (e quindi il PHP) pertanto l&rsquo;indirizzo da specificare è &ldquo;localhost&rdquo;. Se invece il server si trova su un diverso computer, raggiungibile attraverso una connessione TCP/IP, allora bisogna specificare il nome di dominio (es. sql.mioserver.it) o l&rsquo;indirizzo IP (es. 162.54.23.12) della macchina che lo ospita.</li><li><strong>nome utente e password</strong>: si tratta delle credenziali che permettono al server MySQL di identificare l&rsquo;utente che effettua la richiesta di connessione. Se abbiamo appena installato MySQL allora possiamo usare il nome utente &ldquo;root&rdquo; e per password quella specificata durante l&rsquo;installazione.</li></ul><p>La funzione mysql_connect() restituisce come risultato un numero che costituisce l'<em>identificativo di connessione MySQL</em> (&ldquo;MySQL link identifier&rdquo; oppure " MySQL-Link resource") in caso di successo oppure FALSE in caso contrario. E' quindi possibile verificare l&rsquo;esito della connessione semplicemente controllando il risultato restituito da mysql_connect().</p><p>Se qualcosa va storto possiamo inoltre ottenere maggiori informazioni sull&rsquo;accaduto utilizzando un&rsquo;altra funzione, <strong>mysql_error()</strong>, che ci mostrerà un messaggio esplicativo sul problema verificatosi.</p><p>Effettuata la connessione a MySQL si è soliti specificare il nome del database su cui si vogliono effettuare le query. Infatti uno script PHP generalmente effettua diverse query ma tutte su tebelle appartenenti ad uno stesso database. Per dichiarare il nome del database si usa la funzione <strong>mysql_select_db()</strong> che restituisce TRUE o FALSE a seconda dell&rsquo;esito dell&rsquo;operazione. Anche questa volta conviene subito controllare tale risultato ed eventualmente mostrare un messaggio di errore con la funzione mysql_error().</p><p>Anche se tutte le connessioni ai server MySQL vengono automaticamente chiuse alla fine dell&rsquo;esecuzione dello script, è buona norma chiudere la connessione esplicitamente, appena lo script ha terminato le operazioni con il database. Per farlo basta richiamare la funzione <strong>mysql_close()</strong> a cui passiamo come parametro l&rsquo;identificativo di connessione ottenuto da mysql_connect().</p><p>Vediamo quindi un semplice esempio di connessione, selezione del DB e chiusura del link:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
$link <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_connect</span>(<span style=color:#e6db74>&#39;localhost&#39;</span>, <span style=color:#e6db74>&#39;nome_utente&#39;</span>, <span style=color:#e6db74>&#39;password&#39;</span>);
<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$link) {
   <span style=color:#66d9ef>die</span> (<span style=color:#e6db74>&#39;Non riesco a connettermi: &#39;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>mysql_error</span>());
}

$db_selected <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_select_db</span>(<span style=color:#e6db74>&#39;prova&#39;</span>, $link);
<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$db_selected) {
   <span style=color:#66d9ef>die</span> (<span style=color:#e6db74>&#34;Errore nella selezione del database: &#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>mysql_error</span>());
}

<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;connesso con successo&#39;</span>;

<span style=color:#a6e22e>mysql_close</span>($link);
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Ecco nel dettaglio il funzionamento del precedente script:</p><ul><li>la riga 2 effettua la connessione al server attraverso la funzione mysql_connect() a cui viene passato l&rsquo;indirizzo del server (&lsquo;localhost&rsquo;), il nome dell&rsquo;utente di MySQL (&lsquo;nome_utente&rsquo;) e la relativa password (&lsquo;password&rsquo;);</li><li>la riga 3 controlla il valore di $link restituito da mysql_connect(). Se vale FALSE la riga 4 mostra un messaggio di errore grazie alla funzione mysql_error() e termina lo script;</li><li>la riga 7 seleziona il database da utilizzare, richiamando la funzione mysql_select_db() a cui passiamo il nome del database &lsquo;prova&rsquo; ed il $link che identifica la connessione appena effettuata.</li><li>la riga 8 controlla il valore di $db_selected restituito da mysql_select_db(). Se vale FALSE la riga 9 mostra un messaggio di errore grazie alla funzione mysql_error() e termina lo script;</li><li>la riga 14 infine chiude la connessione al server MySQL attraverso la funzione mysql_close().</li></ul><p>La connessione va eseguita una sola volta per script, generalmente all&rsquo;inizio del codice, poiché è necessario che questa preceda l&rsquo;esecuzione delle query. E' possibile effettuare più connessioni all&rsquo;interno di uno stesso script ma questo ha senso solo se ci si deve interfacciare con diversi server MySQL, circostanza piuttosto rara.</p><p>Quella vista è la procedura di connessione comunemente impiegata negli script PHP/MySQL. Si possono verificare però condizioni e circostanze che richiedono un uso differente della funzione mysql_connect(), mostrate di seguito attraverso degli esempi:</p><ul><li>per collegarsi al server MySQL presente sull&rsquo;host miodominio.it (diverso da localhost) usando una porta differente da quella standard (3306), ad esempio la 3307:
<code>&lt;span style="color: rgb(0, 0, 0);">$link = mysql_connect('miodominio.it:3307', 'nome_utente', 'password');&lt;/span></code></li><li>per collegarsi al server MySQL presente il localhost usando una porta differente da quella standard (3306), ad esempio la 3307:
<code>&lt;span style="color: rgb(0, 0, 0);">$link = mysql_connect('127.0.0.1:3307', 'nome_utente', 'password');&lt;/span></code>
Si noti che non è stato usato come host &lsquo;localhost:3307&rsquo; perché PHP avrebbe creato una connessione attraverso socket (named pipe su Windows) invece di usare il TCP/IP e quindi avrebbe ignorato il numero di porta.</li><li>per collegarsi a localhost specificando il percorso del socket:
<code>&lt;span style="color: rgb(0, 0, 0);">$link = mysql_connect('/tmp/mysql', 'nome_utente', 'password');&lt;/span></code>
oppure:
<code>&lt;span style="color: rgb(0, 0, 0);">$link = mysql_connect('localhost:/tmp/mysql.sock', 'nome_utente', 'password');&lt;/span></code></li></ul><p>Accanto all&rsquo;indicazione del server, del nome utente e della password, la funzione mysql_connect() accetta due ulteriori parametri:</p><p><strong>new_link</strong>: se in uno script viene chiamata la funzione mysql_connect() due o più volte con gli stessi parametri, questa restituirà sempre lo stesso identificativo di connessione. Questo perché mysql_connect() evita di aprire nuovi (inutili) link ad uno stesso server MySQL. Se si vuole disabilitare questo comportamento basta porre il parametro new_link a TRUE.</p><p><strong>client_flags</strong>: una combinazione di flag (MYSQL_CLIENT_IGNORE_SPACE, MYSQL_CLIENT_IGNORE_SPACE, MYSQL_CLIENT_INTERACTIVE, MYSQL_CLIENT_SSL).</p><p>Per i dettagli si rimanda alla <a href=http://it2.php.net/manual/it/function.mysql-connect.php>documentazione ufficiale</a>.</p><h3 id=connessioni-persistenti>Connessioni persistenti</h3><p>La procedura di connessione vista comporta la creazione di un nuovo link tra PHP e MySQL ad ogni esecuzione dello script. Questo collegamento viene interrotto con la funzione mysql_close() o automaticamente al termine dello script. Alla semplicità di questo approccio si contrappone un&rsquo;evidente inefficienza: la procedura di connessione, ripetuta ad ogni esecuzione dello script, potrebbe risultare onerosa in termini di prestazioni, soprattutto se PHP e MySQL sono su macchine differenti.</p><p>Per ovviare a questo problema è possibile utilizzare le connessioni persistenti. In pratica, attraverso la funzione <strong>mysql_pconnect()</strong> che segue la stessa sintassi della mysql_connect(), si cerca di riciclare vecchie connessioni precedentemente aperte e ancora attive. Il funzionamento è il seguente:</p><ul><li>per prima cosa la funzione mysql_pconnect() cerca un link persistente ancora attivo, aperto da una precedente chiamata a mysql_pconnect() effettuata impiegato gli stessi dati per host, username e password;</li><li>se tale link viene trovato allora mysql_pconnect() non apre una nuova connessione ma restituisce l&rsquo;identificativo di connessione del vecchio collegamento, ovvero riutilizza la vecchia connessione;</li><li>se non è disponibile un link persistente ancora attivo allora se ne crea uno nuovo;</li><li>infine, al termine dello script, il link non viene chiuso, neanche se viene invocata la funzione mysql_close().</li></ul><p>Come accennato, le connessioni persistenti hanno come unico obbiettivo la riduzione dell&rsquo;overhead legato alla fase di creazione dei link tra PHP e MySQL. Purtroppo però l&rsquo;uso delle connessioni persistenti richiede una certa abilità nel configurare il server. Se infatti MySQL è configurato per non aprire più di un certo numero di connessioni contemporaneamente, la richiesta di una ulteriore connessione da parte di PHP non verrà soddisfatta con conseguenze ovvie sul suo funzionamento dello script.</p><p>Per questo, e per altri inconvenienti che si potrebbero verificare, si rimanda alla documentazione di PHP (in particolare a <a href=http://it2.php.net/manual/en/features.persistent-connections.php>questa pagina</a>) e MySQL.</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/corsi/corso-php-mysql/setup-del-server-e-creazione-del-database/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Setup del server e creazione del database</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/corsi/corso-php-mysql/script-di-connessione/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Script di connessione</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>