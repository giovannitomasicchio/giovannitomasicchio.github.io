<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Inserire un nuovo album - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Inserimento di un nuovo record nel database con Zend Framework"><meta property="og:title" content="Inserire un nuovo album"><meta property="og:description" content="Inserimento di un nuovo record nel database con Zend Framework"><meta property="og:type" content="article"><meta property="og:url" content="https://www.giovannitomasicchio.it/corsi/corso-zend-framework/inserire-un-nuovo-album/"><meta property="article:section" content="corsi"><meta property="article:published_time" content="2010-12-28T16:27:27+00:00"><meta property="article:modified_time" content="2010-12-28T16:27:27+00:00"><meta itemprop=name content="Inserire un nuovo album"><meta itemprop=description content="Inserimento di un nuovo record nel database con Zend Framework"><meta itemprop=datePublished content="2010-12-28T16:27:27+00:00"><meta itemprop=dateModified content="2010-12-28T16:27:27+00:00"><meta itemprop=wordCount content="608"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Inserire un nuovo album"><meta name=twitter:description content="Inserimento di un nuovo record nel database con Zend Framework"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Inserire un nuovo album</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2010-12-28T16:27:27Z>28 December 2010</time></div></div></header><div class="content post__content clearfix"><p>Creiamo adesso la funzione per aggingere un nuovo album. Ci sono due cose da fare:</p><ul><li>visualizzare un form all&rsquo;utente affinché possa inserire i dati</li><li>processare l&rsquo;invio del form e salvare i dati nel database</li></ul><p>Usiamo Zend_Form per fare il tutto. Il componente Zend_Form permette di creare un form e validare i dati inseriti. Creiamo una nuova classe Form_Album che estende Zend_Form per definire il nostro form. Come una risorsa dell&rsquo;applicazione, la classe viene salvata nel file Album.php nella directory forms. Iniziamo usando lo strumento da riga di comando zf per creare il file corretto:</p><pre><code>
zf create form Album
</code></pre><p>Questo crea il file Album.php in application/forms che include un metodo init() dove si può impostare il form e aggiungere gli elementi di cui abbiamo bisogno. Modifichiamo application/forms/Album.php, cancelliamo i commenti in init() e aggiungiamo quanto segue:</p><p>zf-tutorial/application/forms/Album.php</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application_Form_Album</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Zend_Form</span>
{
   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>()
   {
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#39;album&#39;</span>);

   $id <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Form_Element_Hidden</span>(<span style=color:#e6db74>&#39;id&#39;</span>);
   $id<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addFilter</span>(<span style=color:#e6db74>&#39;Int&#39;</span>);

   $artist <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Form_Element_Text</span>(<span style=color:#e6db74>&#39;artist&#39;</span>);
   $artist<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setLabel</span>(<span style=color:#e6db74>&#39;Artist&#39;</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setRequired</span>(<span style=color:#66d9ef>true</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addFilter</span>(<span style=color:#e6db74>&#39;StripTags&#39;</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addFilter</span>(<span style=color:#e6db74>&#39;StringTrim&#39;</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addValidator</span>(<span style=color:#e6db74>&#39;NotEmpty&#39;</span>);

   $title <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Form_Element_Text</span>(<span style=color:#e6db74>&#39;title&#39;</span>);
   $title<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setLabel</span>(<span style=color:#e6db74>&#39;Title&#39;</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setRequired</span>(<span style=color:#66d9ef>true</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addFilter</span>(<span style=color:#e6db74>&#39;StripTags&#39;</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addFilter</span>(<span style=color:#e6db74>&#39;StringTrim&#39;</span>)
       <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addValidator</span>(<span style=color:#e6db74>&#39;NotEmpty&#39;</span>);

   $submit <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Form_Element_Submit</span>(<span style=color:#e6db74>&#39;submit&#39;</span>);
   $submit<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setAttrib</span>(<span style=color:#e6db74>&#39;id&#39;</span>, <span style=color:#e6db74>&#39;submitbutton&#39;</span>);

   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addElements</span>(<span style=color:#66d9ef>array</span>($id, $artist, $title, $submit));
   }
}
</code></pre></div><p>Con il metodo init() di Application_Form_Album, creiamo quattro elementi per l&rsquo;id, l&rsquo;artista, il titolo ed il bottone di submit. Per ogni elemento impostiamo vari attributi, inclusi le label da visualizzare. Per id, vogliamo assicurarci che sia inserito solo un numero intero per prevenire potenziali attacchi di tipo SQL injection. Il filtro Int farà questo per noi.</p><p>Per gli elementi di tipo testo, aggiungiamo due filtri, StripTags e StringTrim per rimuovere codice HTML e spazi bianchi inutili. Li impostiamo inoltre come obbligatori (required) e aggiungiamo un controllo (validator) di tipo NotEmpty per assicurarci che l&rsquo;utente inserisca le informazioni necessarie. (Il controllo NotEmpty non è tecnicamente necessario dato che è automatiamente aggiunto dal sistema quando setRequired() è impostato a &lsquo;true&rsquo;; è stato inserito solo per mostrare come aggiungere un validator.)</p><p>Abbiamo ora bisogno di visualizzare il form e processare l&rsquo;invio dei dati. Ciò avviene all&rsquo;interno di addAction() dell&rsquo;IndexController:</p><p>zf-tutorial/application/controllers/IndexController.php</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>...</span>
<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>addAction</span>()
{
   $form <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Application_Form_Album</span>();
   $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>submit</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setLabel</span>(<span style=color:#e6db74>&#39;Add&#39;</span>);
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>form</span> <span style=color:#f92672>=</span> $form;
   <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRequest</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isPost</span>()) {
       $formData <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRequest</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>();
       <span style=color:#66d9ef>if</span> ($form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isValid</span>($formData)) {
       $artist <span style=color:#f92672>=</span> $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>(<span style=color:#e6db74>&#39;artist&#39;</span>);
       $title <span style=color:#f92672>=</span> $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>(<span style=color:#e6db74>&#39;title&#39;</span>);
       $albums <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Application_Model_DbTable_Albums</span>();
       $albums<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addAlbum</span>($artist, $title);

       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_helper</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>redirector</span>(<span style=color:#e6db74>&#39;index&#39;</span>);
       } <span style=color:#66d9ef>else</span> {
       $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>populate</span>($formData);
       }
   }
}
<span style=color:#f92672>...</span>
</code></pre></div><p>Esaminiamo il codice più in dettaglio:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$form <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Application_Form_Album</span>();
$form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>submit</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setLabel</span>(<span style=color:#e6db74>&#39;Add&#39;</span>);
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>form</span> <span style=color:#f92672>=</span> $form;
</code></pre></div><p>Istanziamo il nostro Form_Album, impostiamo la label per il bottone submit ad &ldquo;Add&rdquo; e poi assegniamo il tutto all&rsquo;oggetto view per il rendering.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRequest</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isPost</span>()) {
   $formData <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRequest</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>();
   <span style=color:#66d9ef>if</span> ($form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isValid</span>($formData)) {
</code></pre></div><p>Se il metodo isPost() dell&rsquo;oggetto request restituisce true, allora il form è stato inviato e si possono recuperare i dati del form con getPost() e di conseguenza controllare la validità dello stesso usando la funzione isValid().</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$artist <span style=color:#f92672>=</span> $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>(<span style=color:#e6db74>&#39;artist&#39;</span>);
$title <span style=color:#f92672>=</span> $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getValue</span>(<span style=color:#e6db74>&#39;title&#39;</span>);
$albums <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Application_Model_DbTable_Albums</span>();
$albums<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addAlbum</span>($artist, $title);
</code></pre></div><p>Se il form è valido, si può istanziare il model Application_Model_DbTable_Albums e usare addAlbum(), creato precedentemente, per inserire un nuovo record nel database.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_helper</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>redirector</span>(<span style=color:#e6db74>&#39;index&#39;</span>);
</code></pre></div><p>Dopo aver salvato il nuovo album, si procede con un redirect usando l&rsquo;action helper Redirector per ritornare all&rsquo;action index (ovvero per tornare alla home page).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>} <span style=color:#66d9ef>else</span> {
   $form<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>populate</span>($formData);
}
</code></pre></div><p>Se i dati del form non sono validi, allora popoliamo il form con i dati che l&rsquo;utente ha inserito e ri-visualizziamo il form.</p><p>Adesso dobbiamo creare il form nello script view add.phtml:</p><p>zf-tutorial/application/views/scripts/index/add.phtml</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>title</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Add new album&#34;</span>;
$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>headTitle</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>title</span>);
<span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>form</span> ;
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Come possiamo vedere, mostrare un form è davvero facile - basta semplicemente stamparlo con un echo poiché il form sa esattamente come deve mostrarsi. Adesso dovremmo essere in grado di usare il link &ldquo;Add new album&rdquo; presente nella home page dell&rsquo;applicazione per aggiungere un nuovo album.</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/corsi/corso-zend-framework/elenco-degli-album/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Elenco degli album</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/corsi/corso-zend-framework/modificare-un-album/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Modificare un album</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>