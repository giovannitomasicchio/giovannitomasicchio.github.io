<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Model - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Creare il model di una applicazione MVC con Zend Framework utilizzando Zend_Db_Table"><meta property="og:title" content="Model"><meta property="og:description" content="Creare il model di una applicazione MVC con Zend Framework utilizzando Zend_Db_Table"><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/corsi/corso-zend-framework/model/"><meta property="article:section" content="corsi"><meta property="article:published_time" content="2010-12-28T16:18:53+00:00"><meta property="article:modified_time" content="2010-12-28T16:18:53+00:00"><meta itemprop=name content="Model"><meta itemprop=description content="Creare il model di una applicazione MVC con Zend Framework utilizzando Zend_Db_Table"><meta itemprop=datePublished content="2010-12-28T16:18:53+00:00"><meta itemprop=dateModified content="2010-12-28T16:18:53+00:00"><meta itemprop=wordCount content="620"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Model"><meta name=twitter:description content="Creare il model di una applicazione MVC con Zend Framework utilizzando Zend_Db_Table"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Model</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2010-12-28T16:18:53Z>28 December 2010</time></div></div></header><div class="content post__content clearfix"><p>Zend Framework non fornisce una classe Zend_Model, dato che il model è la nostra logica di business ed è lasciata a noi la decisione di come farla funzionare. Ci sono molti componenti che possimamo usare, dipende dalle necessità. Un approccio consiste nell&rsquo;avere una classe model per ciascuna entità della nostra applicazione e poi usere degli oggetti &ldquo;mapper&rdquo; per caricare e salvare le varie entità nel database. Questo approccio è documentato nella guida QuickStart a Zend Framework: <a href=http://framework.zend.com/manual/en/learning.quickstart.create-model.html.>http://framework.zend.com/manual/en/learning.quickstart.create-model.html</a>.</p><p>Per questo tutorial, andremo a creare un model che estende Zend_Db_Table e usa Zend_Db_Table_Row. Zend Framework fornisce Zend_Db_Table che implementa il pattern Table Data Gateway che permette di interfacciarsi ai dati di una tabella del database. Dobbiamo essere consapevoli che il pattern Table Data Gateway può essere limitativo in un sistema più ampio. Potremmo avere anche la tentazione di mettere il codice di accesso al database in una action di un controller poiché questo viene esposto da Zend_Db_Table.</p><p>Zend_Db_Table_Abstract è una classe astratta, dalla quale deriveremo la nostra classe specifica per gestire gli album. Non ha importanza come chiameremo la nostra classe, ma ha senso chiamarla con lo stesso nome della tabella del database.</p><p>Il nostro progetto dispone di un autoloader di default istanziato da Zend_Application che mappa le classi di risorsa appartenenti ad un modulo nella directory dove esso è definito. Per la cartella principale application/ useremo il prefisso Application_.</p><p>L&rsquo;autoloader associa le risorse e le relative directory in questo modo:</p><table><thead><tr><th>Prefisso</th><th>Directory</th></tr></thead><tbody><tr><td>Form</td><td>forms</td></tr><tr><td>Model</td><td>models</td></tr><tr><td>Model_DbTable</td><td>models/DbTable</td></tr><tr><td>Model_Mapper</td><td>models/mappers</td></tr><tr><td>Plugin</td><td>plugins</td></tr><tr><td>Service</td><td>services</td></tr><tr><td>View_Filter</td><td>views/filters</td></tr><tr><td>View_Helper</td><td>views/helper</td></tr></tbody></table><p>Poiché chiameremo il model con lo stesso nome della tabella del database &ldquo;albums&rdquo; ed useremo Zend_Db_Table, la nostra classe si chiamerà Application_Model_DbTable_Albums, che verrà salvata in applications/models/DbTable/Albums.php.</p><p>Per indicare a Zend_Db_Table il nome della tabella che useremo, dobbiamo impostare un attributo protetto $_name con il nome della tabella. Inoltre Zend_Db_Table assumerà che la nostra tabella possieda una chiave primaria di nome &ldquo;id&rdquo; di tipo auto-increment. Anche il nome di questa colonna può essere cambiato se necessario.</p><p>Possiamo usare il comando zf per farci fare parte del lavoro, quindi lanciamo il seguente comando da terminale:</p><pre><code>
zf create db-table Albums albums
</code></pre><p>Lo strumento a riga di comando ha creato adesso il file Albums.php nella cartella application/models/DbTable. All&rsquo;interno di questo file c&rsquo;è la classe Application_Model_DbTable_Albums nella quale è impostato il nome della tabella del database con cui comunicherà.</p><p>Adesso dobbiamo aggiungere qualche funzionalità, modifichiamo quindi application/models/DbTable/Albums.php e aggiungiamo i metodi getAlbum(), addAlbum(), updateAlbum() e deleteAlbum() e ora dovrebbe assomigliare a qualcosa di simile a questo:</p><p>zf-tutorial/application/models/DbTable/Albums.php</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Application_Model_DbTable_Albums</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Zend_Db_Table_Abstract</span>
{
   <span style=color:#66d9ef>protected</span> $_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;albums&#39;</span>;

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAlbum</span>($id)
   {
   $id <span style=color:#f92672>=</span> (<span style=color:#a6e22e>int</span>)$id;
   $row <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>fetchRow</span>(<span style=color:#e6db74>&#39;id = &#39;</span> <span style=color:#f92672>.</span> $id);
   <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$row) {
       <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Could not find row </span><span style=color:#e6db74>$id</span><span style=color:#e6db74>&#34;</span>);
   }
   <span style=color:#66d9ef>return</span> $row<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>toArray</span>();
   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>addAlbum</span>($artist, $title)
   {
   $data <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
       <span style=color:#e6db74>&#39;artist&#39;</span> <span style=color:#f92672>=&gt;</span> $artist,
       <span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#f92672>=&gt;</span> $title,
   );
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>insert</span>($data);
   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>updateAlbum</span>($id, $artist, $title)
   {
   $data <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
       <span style=color:#e6db74>&#39;artist&#39;</span> <span style=color:#f92672>=&gt;</span> $artist,
       <span style=color:#e6db74>&#39;title&#39;</span> <span style=color:#f92672>=&gt;</span> $title,
   );
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>update</span>($data, <span style=color:#e6db74>&#39;id = &#39;</span><span style=color:#f92672>.</span> (<span style=color:#a6e22e>int</span>)$id);
   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteAlbum</span>($id)
   {
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>delete</span>(<span style=color:#e6db74>&#39;id =&#39;</span> <span style=color:#f92672>.</span> (<span style=color:#a6e22e>int</span>)$id);
   }
}
</code></pre></div><p>Abbiamo creato quattro metodi helper che la nostra applicazione userà per interfacciarsi alla tabella del database. getAlbum() recupera una singola riga sotto forma di array, addAlbum() crea una nuova riga nel database, updateAlbum() aggiorna la riga di un album e deleteAlbum() rimuove completamente una riga. Il codice di ogni metodo è auto esplicativo. Sebbene non necessario ai fini di questo tutorial, è anche possibile indicare a Zend_Db_Table le tabelle correlate in modo che possa trovare anche dati relazionati.
Ora abbiamo bisogno di riempire il controller dei dati provenienti dal model affinché gli script di view li possano mostrare, ma prima di procedere dobbiamo capire come funziona il sistema di view di Zend Framework.</p></div></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/corsi/corso-zend-framework/preparazione-del-database/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Preparazione del database</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/corsi/corso-zend-framework/view/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>View</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>