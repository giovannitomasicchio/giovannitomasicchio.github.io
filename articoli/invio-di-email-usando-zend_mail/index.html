<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Invio di email usando Zend_Mail - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Inviare email con Zend_Mail proteggendo il form dallo spam con Zend_Service_ReCaptcha"><meta property="og:title" content="Invio di email usando Zend_Mail"><meta property="og:description" content="Inviare email con Zend_Mail proteggendo il form dallo spam con Zend_Service_ReCaptcha"><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/articoli/invio-di-email-usando-zend_mail/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2010-09-06T07:30:00+00:00"><meta property="article:modified_time" content="2010-09-06T07:30:00+00:00"><meta itemprop=name content="Invio di email usando Zend_Mail"><meta itemprop=description content="Inviare email con Zend_Mail proteggendo il form dallo spam con Zend_Service_ReCaptcha"><meta itemprop=datePublished content="2010-09-06T07:30:00+00:00"><meta itemprop=dateModified content="2010-09-06T07:30:00+00:00"><meta itemprop=wordCount content="1496"><meta itemprop=keywords content="Zend Framework,CAPTCHA,email,SMTP,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Invio di email usando Zend_Mail"><meta name=twitter:description content="Inviare email con Zend_Mail proteggendo il form dallo spam con Zend_Service_ReCaptcha"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Invio di email usando Zend_Mail</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2010-09-06T07:30:00Z>6 September 2010</time></div></div></header><div class="content post__content clearfix"><p>Questo articolo illustra come utilizzare lo <a href=http://framework.zend.com/>Zend Framework</a> per realizzare un form di invio email, utile ad esempio agli utenti per contattare l&rsquo;amministratore del sito oppure per segnalare una pagina del sito ad amici. Zend Framework fornisce tutti gli oggetti necessari allo scopo, oggetti che possono essere usati singolarmente, al di fuori di una applicazione MVC.
L&rsquo;uso di un framework non deve spaventare coloro che non si sentono degli esperti nella programmazione in PHP. Al contrario l&rsquo;utilizzo degli oggetti forniti dal framework semplifica e velocizza la realizzazione dello script.</p><p>Iniziamo con la creazione del form in HTML che permetterà di inviare i dati inseriti dall&rsquo;utente tramite $_POST allo script send.php:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>form</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;send.php&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form&#34;</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>table</span> <span style=color:#a6e22e>border</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;0px&#34;</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align: right&#34;</span><span style=color:#f92672>&gt;</span>
  <span style=color:#a6e22e>Tuo</span> <span style=color:#a6e22e>Nome</span><span style=color:#f92672>:</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;name&#34;</span> <span style=color:#a6e22e>size</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;40&#34;</span> <span style=color:#a6e22e>maxlength</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;80&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align: right&#34;</span><span style=color:#f92672>&gt;</span>
  <span style=color:#a6e22e>Tua</span> <span style=color:#a6e22e>Email</span><span style=color:#f92672>:</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;email&#34;</span> <span style=color:#a6e22e>size</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;40&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align: right&#34;</span><span style=color:#f92672>&gt;</span>
  <span style=color:#a6e22e>Oggetto</span><span style=color:#f92672>:</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;subject&#34;</span> <span style=color:#a6e22e>size</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;40&#34;</span> <span style=color:#a6e22e>maxlength</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;80&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align: right&#34;</span><span style=color:#f92672>&gt;</span>
  <span style=color:#a6e22e>Testo</span><span style=color:#f92672>:</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>textarea</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;testo&#34;</span> <span style=color:#a6e22e>cols</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;60&#34;</span> <span style=color:#a6e22e>rows</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;10&#34;</span><span style=color:#f92672>&gt;&lt;/</span><span style=color:#a6e22e>textarea</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>td</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align: right&#34;</span><span style=color:#f92672>&gt;</span>
  <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Invia&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>td</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>tr</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>table</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>form</span><span style=color:#f92672>&gt;</span>

</code></pre></div><p>Proseguiamo con la creazione dello script send.php. Per prima cosa è bene fare un controllo sull&rsquo;array $_POST. Se questo è vuoto è inutile proseguire poiché significa che l&rsquo;utente non ha inviato il form, mostriamo quindi un messaggio di errore.</p><p>Il passaggio successivo sarà richiamare l&rsquo;oggetto <a href=http://framework.zend.com/manual/en/zend.loader.html>Zend_Loader_Autoloader</a>. Questa classe permette di caricare in automatico i vari oggetti del framework senza la necessità di dover includere i singoli script del framework contenenti le classi che ci interessano.</p><p>Fatto ciò possiamo istanziare un oggetto <a href=http://framework.zend.com/manual/en/zend.mail.html>Zend_Mail</a> (referenziato dalla variabile $mail nello script) e comporre così l&rsquo;email.</p><p>La composizione di una email a partire dai campi del form creato precedentemente è davvero semplice ed intuitiva e uno sguardo allo script send.php lo dimostra chiaramente.</p><p>Fatto ciò si deve spedire la posta. Prima però è necessario indicare a Zend_Mail con quale &ldquo;trasporter&rdquo; inviare la propria email, ovvero quale sistema di invio impiegare. Di default l&rsquo;invio di una email avviene tramite Zend_Mail_Transport_Sendmail. Questo transporter utilizza il server sendmail impostato nella configurazione del php. Dunque per inviare l&rsquo;email basterebbe utilizzare il metodo send di Zend_Mail e l&rsquo;email viene inviata.
Supponiamo però di voler utilizzare un server SMTP. Per farlo ci viene in aiuto un oggetto molto interessante: Zend_Mail_Transport_Smtp. Nello script send.php si può vedere come si impostano i parametri di connessione al server SMTP.
Infine, tramite il metodo send di Zend_Mail si invia l&rsquo;email indicando il &ldquo;transporter&rdquo; creato:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
   <span style=color:#75715e>// includo la cartella del framework
</span><span style=color:#75715e></span>   <span style=color:#75715e>// Attenzione, il path impostato è per server windows, se si è su un server linux il path dovrebbe essere del tipo: /directory/zendframework/library
</span><span style=color:#75715e></span>   <span style=color:#a6e22e>set_include_path</span>(<span style=color:#a6e22e>get_include_path</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>PATH_SEPARATOR</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;C:\Programmi\ZendFramework\library&#34;</span>);
   
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Se il form è stato riempito procedo con l&#39;invio della email  
</span><span style=color:#e6db74>    */</span>
   <span style=color:#66d9ef>if</span>($_POST){

   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Richiamo il file contenente la mia classe Zend_Loader_Autoloader
</span><span style=color:#e6db74>    *
</span><span style=color:#e6db74>    * in questo modo posso caricare facilmente tutte le classi di
</span><span style=color:#e6db74>    * Zend Framework agevolmente senza dover ogni volta fare un require
</span><span style=color:#e6db74>    * come sto facendo ora
</span><span style=color:#e6db74>    */</span>
   <span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#34;Zend/Loader/Autoloader.php&#34;</span>);
   
   $autoloader <span style=color:#f92672>=</span> <span style=color:#a6e22e>Zend_Loader_Autoloader</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
   
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Istanzio il mio oggetto Zend_Mail
</span><span style=color:#e6db74>    */</span>
   $mail <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Mail</span>();

   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    *  Compongo la mia email 
</span><span style=color:#e6db74>    *  impostando le varie parti dell&#39;email
</span><span style=color:#e6db74>    */</span>
   $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addTo</span>(<span style=color:#e6db74>&#39;mario@example.com&#39;</span>, <span style=color:#e6db74>&#39;Mario Santagiuliana&#39;</span>);
   
   $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setFrom</span>($_POST[<span style=color:#e6db74>&#39;email&#39;</span>], $_POST[<span style=color:#e6db74>&#39;name&#39;</span>]);
   $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setSubject</span>($_POST[<span style=color:#e6db74>&#39;subject&#39;</span>]);
   $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setBodyText</span>($_POST[<span style=color:#e6db74>&#39;testo&#39;</span>]);

   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    *  Voglio usare il mio server smtp, imposto i
</span><span style=color:#e6db74>    *  parametri di configurazione per la connessione smtp 
</span><span style=color:#e6db74>    */</span>
   $config <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;auth&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;login&#39;</span>,
       <span style=color:#e6db74>&#39;username&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;mario@example.com&#39;</span>,
       <span style=color:#e6db74>&#39;password&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;la_mia_password&#39;</span>,
       <span style=color:#e6db74>&#39;port&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>25</span>);
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    *  Istanzio l&#39;oggetto Zend_Mail_Transport_Smtp indicandogli i
</span><span style=color:#e6db74>    *  parametri di connessione e di accesso
</span><span style=color:#e6db74>    */</span>
   $transport <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Mail_Transport_Smtp</span>(<span style=color:#e6db74>&#39;smtp.example.com&#39;</span>, $config);
   
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Invio l&#39;email tramite il mio server smtp appena configurato
</span><span style=color:#e6db74>    * e stampo un messaggio di corretta esecuzione dello script
</span><span style=color:#e6db74>    */</span>
   $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>send</span>($transport);
   $messaggio <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Email inviata correttamente&#34;</span>;
   } <span style=color:#66d9ef>else</span> {
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Imposto un messaggio generico di errore
</span><span style=color:#e6db74>    */</span>
   $messaggio <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Non hai riempito il form per il messaggio&#34;</span>;
   }

   <span style=color:#75715e>// Stampo il messaggio
</span><span style=color:#75715e></span>   <span style=color:#66d9ef>echo</span> $messaggio;
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Come si può vedere la creazione dello script, utilizzando le classi di Zend è oltremodo semplice e veloce.</p><hr><p>Allo script appena visto però manca ancora qualche cosa. Cosa succede se l&rsquo;utente inserisce un indirizzo email sbagliato? Come evitare un utilizzo improprio dello script, ad esempio per inviare spam?</p><p>Nessun problema, Zend Framework fornisce un oggetto per controllare la validità di un indirizzo email: <a href=http://framework.zend.com/manual/en/zend.validate.set.html>Zend_Validate_EmailAddress</a>. Includiamo quindi questo controllo nello script precedente (referenziato da $validator) bloccando l&rsquo;esecuzione dello script nel caso l&rsquo;email fornita non sia valida.
Invece per limitare l&rsquo;uso improprio del form ed evitare lo spam, Zend Framework mette a disposizione due componenti: Zend_Captcha e <a href=http://framework.zend.com/manual/en/zend.service.recaptcha.html>Zend_Service_ReCaptcha</a>. Nell&rsquo;esempio che segue vedremo l&rsquo;utilizzo di quest&rsquo;ultimo. E' necessario essere registrati al servizio <a href=http://www.google.com/recaptcha>ReCaptha</a> e possedere le relative chiavi per poterlo utilizzare.</p><p>L&rsquo;uso è molto semplice, basta istanziare l&rsquo;oggetto e inserire il controllo a monte, subito dopo aver verificato che l&rsquo;array POST abbia degli elementi al suo interno. Bisogna inoltre modificare anche il codice HTML del form per poter inserire al suo interno anche il codice di ReCaptcha.</p><p>Invece di modificare il file HTML, stavolta lo includiamo direttamente all&rsquo;interno dello script send.php. In questo modo avremo un unico script. Il form HTML subirà un piccolo mutamento in modo tale che i dati vengano inviati a se stesso (il campo action del tag form sarà pertanto vuoto).
Cambieremo inoltre la logica dello script. Zend_Service_ReCaptcha tramite il metodo getHTML fornisce l&rsquo;output del codice per ReCaptcha, sposteremo quindi l&rsquo;inizializzazione di Zend_Loader_Autoloader al di fuori del controllo dell&rsquo;array POST. Un&rsquo;altra piccola modifica la facciamo sul messaggio di errore: se non viene compilato correttamente perché non far visualizzare nuovamente il form?</p><p>Ecco dunque come si presenta lo script finale.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
   <span style=color:#75715e>// includo la cartella del framework
</span><span style=color:#75715e></span>   <span style=color:#75715e>// Attenzione, il path impostato è per server windows, se si è su un server linux il path dovrebbe essere del tipo: /directory/zendframework/library
</span><span style=color:#75715e></span>   <span style=color:#a6e22e>set_include_path</span>(<span style=color:#a6e22e>get_include_path</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>PATH_SEPARATOR</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;C:\Programmi\ZendFramework\library&#34;</span>);

   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Richiamo il file contenente la mia classe Zend_Loader_Autoloader
</span><span style=color:#e6db74>    *
</span><span style=color:#e6db74>    * in questo modo posso caricare facilmente tutte le classi di
</span><span style=color:#e6db74>    * Zend Framework agevolmente senza dover ogni volta fare un require
</span><span style=color:#e6db74>    * come sto facendo ora
</span><span style=color:#e6db74>    */</span>
   <span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#34;Zend/Loader/Autoloader.php&#34;</span>);
   
   $autoloader <span style=color:#f92672>=</span> <span style=color:#a6e22e>Zend_Loader_Autoloader</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>();
   
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Voglio essere sicuro che sia una persona a scrivermi e non una macchina
</span><span style=color:#e6db74>    * uso il servizo di ReCaptcha con Zend_Service_ReCaptcha
</span><span style=color:#e6db74>    */</span>
   $recaptcha <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Service_ReCaptcha</span>(<span style=color:#e6db74>&#39;inserire_la_chiave_pubblica&#39;</span>, <span style=color:#e6db74>&#39;inserire_la_chiave_privata&#39;</span>);
   <span style=color:#75715e>// Abbellisco un po&#39; l&#39;output di recaptcha, la lingua italiana non è ancora disponibile
</span><span style=color:#75715e></span>   $recaptcha<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setOptions</span>(<span style=color:#66d9ef>array</span>(
       <span style=color:#e6db74>&#39;theme&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;clean&#39;</span>,
       <span style=color:#e6db74>&#39;lang&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#e6db74>&#39;it&#39;</span>,
       <span style=color:#e6db74>&#39;tabindex&#39;</span><span style=color:#f92672>=&gt;</span><span style=color:#ae81ff>5</span>
       )); 
   
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Se il form è stato riempito procedo con l&#39;invio della email  
</span><span style=color:#e6db74>    */</span>
   <span style=color:#66d9ef>if</span>($_POST){
   <span style=color:#75715e>// Controllo se il recaptcha inserito è corretto
</span><span style=color:#75715e></span>   $result <span style=color:#f92672>=</span> $recaptcha<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>verify</span>(
       $_POST[<span style=color:#e6db74>&#39;recaptcha_challenge_field&#39;</span>],
       $_POST[<span style=color:#e6db74>&#39;recaptcha_response_field&#39;</span>]
   );
   <span style=color:#75715e>// Se i codici inseriti dall&#39;utente sono validi allora posso proseguire
</span><span style=color:#75715e></span>   <span style=color:#66d9ef>if</span>($result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isValid</span>()){
       <span style=color:#e6db74>/**
</span><span style=color:#e6db74>        * Controllo la validità dell&#39;email, se è valida proseguo con l&#39;Invio
</span><span style=color:#e6db74>        * altrimenti stampo un messaggio di errore 
</span><span style=color:#e6db74>        */</span>
       $validator <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Validate_EmailAddress</span>(); <span style=color:#75715e>// Istanzio l&#39;oggetto
</span><span style=color:#75715e></span>
       <span style=color:#66d9ef>if</span> ($validator<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isValid</span>($_POST[<span style=color:#e6db74>&#39;email&#39;</span>])) {
       <span style=color:#e6db74>/**
</span><span style=color:#e6db74>        * Istanzio il mio oggetto Zend_Mail 
</span><span style=color:#e6db74>        */</span>
       $mail <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Mail</span>();

       <span style=color:#e6db74>/**
</span><span style=color:#e6db74>        *  Compongo la mia email 
</span><span style=color:#e6db74>        *  impostando le varie parti dell&#39;email
</span><span style=color:#e6db74>        */</span>
       $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addTo</span>(<span style=color:#e6db74>&#39;mario@example.com&#39;</span>, <span style=color:#e6db74>&#39;Mario Santagiuliana&#39;</span>);
       
       $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setFrom</span>($_POST[<span style=color:#e6db74>&#39;email&#39;</span>], $_POST[<span style=color:#e6db74>&#39;name&#39;</span>]);
       $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setSubject</span>($_POST[<span style=color:#e6db74>&#39;subject&#39;</span>]);
       $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setBodyText</span>($_POST[<span style=color:#e6db74>&#39;testo&#39;</span>]);

       <span style=color:#e6db74>/**
</span><span style=color:#e6db74>        *  Voglio usare il mio server smtp, imposto i
</span><span style=color:#e6db74>        *  parametri di configurazione per la connessione smtp 
</span><span style=color:#e6db74>        */</span>
       $config <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;auth&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;login&#39;</span>,
           <span style=color:#e6db74>&#39;username&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;mario@example.com&#39;</span>,
           <span style=color:#e6db74>&#39;password&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;la_mia_password&#39;</span>,
           <span style=color:#e6db74>&#39;port&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>25</span>);
       <span style=color:#e6db74>/**
</span><span style=color:#e6db74>        *  Istanzio l&#39;oggetto Zend_Mail_Transport_Smtp indicandogli i
</span><span style=color:#e6db74>        *  parametri di connessione e di accesso
</span><span style=color:#e6db74>        */</span>
       $transport <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Mail_Transport_Smtp</span>(<span style=color:#e6db74>&#39;smtp.example.com&#39;</span>, $config);
       
       <span style=color:#e6db74>/**
</span><span style=color:#e6db74>        * Invio l&#39;email tramite il mio server smtp appena configurato
</span><span style=color:#e6db74>        * e stampo un messaggio di corretta esecuzione dello script
</span><span style=color:#e6db74>        */</span>
       $mail<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>send</span>($transport);
       $messaggio <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Email inviata correttamente&#34;</span>;
       } <span style=color:#66d9ef>else</span> {
       $messaggio <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;L&#39;indirizzo email fornito non è valido&#34;</span>;
       }
   } <span style=color:#66d9ef>else</span> {
       $messaggio <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Il codice captcha che hai inserito non è valido&#34;</span>;
   }
   } <span style=color:#66d9ef>else</span> {
   <span style=color:#e6db74>/**
</span><span style=color:#e6db74>    * Se non ho niente nell&#39;array POST visualizzo il form HTML
</span><span style=color:#e6db74>    * Un eventuale messaggio di errore lo stampo successivamente
</span><span style=color:#e6db74>    */</span>
   <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>   &lt;form method=&#34;post&#34; action=&#34;&#34; name=&#34;form&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;table border=&#34;0px&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;tr&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td style=&#34;text-align: right&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>      Tuo Nome:
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td&gt;
</span><span style=color:#960050;background-color:#1e0010>      &lt;input type=&#34;text&#34; name=&#34;name&#34; size=&#34;40&#34; maxlength=&#34;80&#34; /&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/tr&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;tr&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td style=&#34;text-align: right&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>      Tua Email:
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td&gt;
</span><span style=color:#960050;background-color:#1e0010>      &lt;input type=&#34;text&#34; name=&#34;email&#34; size=&#34;40&#34; /&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/tr&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;tr&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td style=&#34;text-align: right&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>      Oggetto:
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td&gt;
</span><span style=color:#960050;background-color:#1e0010>      &lt;input type=&#34;text&#34; name=&#34;subject&#34; size=&#34;40&#34; maxlength=&#34;80&#34; /&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/tr&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;tr&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td style=&#34;text-align: right&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>      Testo:
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td&gt;
</span><span style=color:#960050;background-color:#1e0010>      &lt;textarea name=&#34;testo&#34; cols=&#34;60&#34; rows=&#34;10&#34;&gt;&lt;/textarea&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/tr&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;tr&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/table&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;?php
</span><span style=color:#960050;background-color:#1e0010>   // Visualizzo il codice HTML di ReCaptcha
</span><span style=color:#960050;background-color:#1e0010>   echo $recaptcha-&gt;getHTML();
</span><span style=color:#960050;background-color:#1e0010>   ?&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;td style=&#34;text-align: right&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>      &lt;input type=&#34;submit&#34; value=&#34;Invia&#34; /&gt;
</span><span style=color:#960050;background-color:#1e0010>    &lt;/td&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/tr&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/form&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;?php
</span><span style=color:#960050;background-color:#1e0010>   }
</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>   // Stampo il messaggio ma solo se esiste
</span><span style=color:#960050;background-color:#1e0010>   if($messaggio)
</span><span style=color:#960050;background-color:#1e0010>   echo $messaggio;
</span><span style=color:#960050;background-color:#1e0010>?&gt;
</span></code></pre></div><p>Come si può vedere, Zend Framework è un ottimo strumento anche per la creazione di piccoli script. Il framework fornisce molti elementi utili per creare in poco tempo script che non necessariamente devono risiedere all&rsquo;interno di un&rsquo;applicazione web basata sul paradigma MVC. Gli oggetti del framework, infatti, possono essere richiamati e inizializzati a piacere.
Lo script che ho proposto può essere ulteriormente migliorato. Per il form HTML si potrebbe utilizzare <a href=http://framework.zend.com/manual/en/zend.form.html>Zend_Form</a> e tramite Zend_Validate fare anche un&rsquo;ulteriore serie di controlli sulla compilazione del form da parte dell&rsquo;utente.
Rimando dunque alla <a href=http://framework.zend.com/manual/en/manual.html>documentazione ufficiale di Zend Framework</a> per scoprire altre opzioni ed utilizzi dei componenti citati.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/zend-framework/ rel=tag>Zend Framework</a></li><li class=tags__item><a class="tags__link btn" href=/tags/captcha/ rel=tag>CAPTCHA</a></li><li class=tags__item><a class="tags__link btn" href=/tags/email/ rel=tag>email</a></li><li class=tags__item><a class="tags__link btn" href=/tags/smtp/ rel=tag>SMTP</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/login-con-php/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Login con PHP</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/introduzione-a-symfony/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Introduzione a symfony</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//giovannitomasicchio-it.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>