<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Zend Framework Tutorial - 2 - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Struttura di una applicazione realizzata con lo Zend Framework"><meta property="og:title" content="Zend Framework Tutorial - 2"><meta property="og:description" content="Struttura di una applicazione realizzata con lo Zend Framework"><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/articoli/zend-framework-tutorial-2/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2007-07-06T23:02:11+00:00"><meta property="article:modified_time" content="2007-07-06T23:02:11+00:00"><meta itemprop=name content="Zend Framework Tutorial - 2"><meta itemprop=description content="Struttura di una applicazione realizzata con lo Zend Framework"><meta itemprop=datePublished content="2007-07-06T23:02:11+00:00"><meta itemprop=dateModified content="2007-07-06T23:02:11+00:00"><meta itemprop=wordCount content="1484"><meta itemprop=keywords content="database,Zend Framework,MySQL,CSS,exception,mod_rewrite,PDO,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zend Framework Tutorial - 2"><meta name=twitter:description content="Struttura di una applicazione realizzata con lo Zend Framework"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Zend Framework Tutorial - 2</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2007-07-06T23:02:11Z>6 July 2007</time></div></div></header><div class="content post__content clearfix"><h3 id=struttura-del-progetto>Struttura del progetto</h3><p>Nel precedente articolo abbiamo cominciato a vedere quali sono gli elementi che costituiscono la nostra applicazione web realizzata con lo Zend Framework. Abbiamo detto che sono necessarie delle classi di tipo Controller per ciascun gruppo di funzionalità correlate, un Controller per gestire la home page (IndexController) ed un altro per la pagina di errore (ErrorController). Abbiamo detto poi che avremmo utilizzato diversi file per conservare i template HTML e uno o più classi Model per effettuare l&rsquo;accesso ai dati. Infine abbiamo visto come il processo di generazione di una qualunque pagina parte da un unico file, il file di bootstrap, che nel nostro esempio si chiama index.php e che contiene un oggetto Front Controller in grado di smistare tutte le richieste dell&rsquo;utente al Controller adeguato.</p><p>Vediamo adesso come questi file sono organizzati nell&rsquo;alberatura delle cartelle del progetto. Supponiamo di conservare tutti i file del progetto in una cartella &ldquo;ZF-tutorial&rdquo; all&rsquo;interno della document root di Apache (la cartella &ldquo;htdocs&rdquo;). Per sfruttare alcuni comodi automatismi dello Zend Framework è conveniente organizzare i file contenenti le classi Controller ed i template HTML secondo un preciso schema. In questo modo ridurremo al minimo lo sforzo di specificare i percorsi dei file.</p><p>Secondo lo schema proposto dallo Zend Framework ciascuna classe Controller va salvata in un file dedicato. La classe deve chiamarsi secondo lo schema <em>NomeClasse</em>Controller ed il file che la contiene deve avere lo stesso nome. Ad esempio il Controller che gestisce le funzionalità associate alle news (visualizzazione, inserimento, modifica e cancellazione) si chiamerà NewsController e verrà salvato nel file NewsController.php. Tutti i Controller devono essere posti in una cartella, che nel nostro esempio si chiama &ldquo;controllers&rdquo; (che fantasia!).</p><p>I file contenenti i template HTML devono essere invece conservati in una cartella di nome &ldquo;views&rdquo;, situata allo stesso livello della cartella dei Controller. La cartella &ldquo;views&rdquo; deve contenere una cartella &ldquo;scripts&rdquo; che a sua volta deve contenere una cartella per ciascun Controller, nella quale inserire solo i template che verranno utilizzati da quel particolare Controller. Queste cartelle devono avere lo stesso nome del Controller, con sole lettere minuscole e senza la desinenza &ldquo;Controller&rdquo;. I file dei template devono avere l&rsquo;estensione phtml e, se hanno lo stesso nome di una Action del Controller, allora verranno caricati in automatico all&rsquo;esecuzione di quella particolare Action. Riprenderemo questo discorso quando commenteremo il codice dei Controller realizzati per la nostra applicazione.</p><p>L&rsquo;immagine seguente mostra l&rsquo;organizzazione dei file appena descritta.</p><p><img src=/image/articoli/cartelle.gif alt=cartelle.gif></p><p>In figura si notano quindi:</p><ul><li>i tre file contenenti i tre Controller (ErrorController, IndexController e NewsController)</li><li>la cartella dei template &ldquo;views&rdquo;, contenente la cartella &ldquo;scripts&rdquo; che a sua volta contiene: una cartella per i template usati dall&rsquo;ErrorController (error.phtml), una per quelli usati dall&rsquo;IndexController (index.phtml) ed una per quelli usati dal NewsController (news-form.phtml e view.phtml)</li><li>il file di bootstrap index.php</li></ul><p>Oltre a quelli precedentemente citati, in figura sono presenti altri file:</p><ul><li>NewsModel.php, l&rsquo;unico Model della nostra applicazione, che contiene la classe responsabile della gestione dei dati.</li><li>main.css che è un semplice file CSS, richiamato in tutte le pagine del sito</li><li>header.phtml e foother.phtml sono 2 template HTML che vengono inclusi da tutti gli altri template dell&rsquo;applicazione e che contengono rispettivamente l&rsquo;intestazione ed il pie' di pagina comuni a tutte le pagine del nostro sito.</li><li>.htaccess, file che ci permette di configurare alcune opzioni di Apache e PHP direttamente dalla cartella della nostra applicazione, che introdurremo nella prossima pagina.</li></ul><p>E' doveroso tener presente che l&rsquo;aver posto le cartelle dei Controller, dei Model e dei template all&rsquo;interno della root di Apache in realtà non è la migliore scelta possibile, poiché così facendo diamo la possibilità agli utenti di accedere direttamente ad ogni singolo file. Sarebbe stato meglio mettere queste cartelle al di fuori della document root del server web. La scelta fatta in questo tutorial è dettata solo da scopi didattici. Ricordo infine che questa organizzazione dei file, come tutte le caratteristiche dello Zend Framework, può essere completamente personalizzata, perdendo semmai qualche automatismo.</p><hr><h3 id=il-file-htaccess>Il file .htaccess</h3><p>Nel precedente articolo avevamo detto che tutte le richieste effettuate dall&rsquo;utente, tutti gli URL della nostra applicazione, vengono in realtà intercettati da un unica pagina di nome index.php, il file di bootstrap. Per ottenere questo risultato è necessario configurare opportunamente il server web, nel nostro caso Apache, ed in questo tutorial utilizzeremo un file .htaccess contenete le seguenti direttive:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#a6e22e>RewriteEngine</span> <span style=color:#a6e22e>on</span>
<span style=color:#a6e22e>RewriteRule</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>\</span><span style=color:#f92672>.</span>(<span style=color:#a6e22e>js</span><span style=color:#f92672>|</span><span style=color:#a6e22e>ico</span><span style=color:#f92672>|</span><span style=color:#a6e22e>gif</span><span style=color:#f92672>|</span><span style=color:#a6e22e>jpg</span><span style=color:#f92672>|</span><span style=color:#a6e22e>png</span><span style=color:#f92672>|</span><span style=color:#a6e22e>css</span>)<span style=color:#960050;background-color:#1e0010>$</span> <span style=color:#a6e22e>index</span><span style=color:#f92672>.</span><span style=color:#a6e22e>php</span>

<span style=color:#a6e22e>php_flag</span> <span style=color:#a6e22e>register_globals</span> <span style=color:#a6e22e>off</span>
<span style=color:#a6e22e>php_flag</span> <span style=color:#a6e22e>magic_quotes_gpc</span> <span style=color:#a6e22e>off</span>
</code></pre></div><p>Con le prime 2 righe attiviamo il motore di conversione degli URL di Apache e lo configuriamo affinché gli URL che puntano a file con estensione diverse da js, ico, gif, jpg, png o css vengano tutti diretti alla pagina index.php. Ricordo che per utilizzare questa funzionalità è necessario attivare l&rsquo;estensione mod_rewrite dal file http.conf e inoltre è necessario abilitare l&rsquo;utilizzo dei file .htaccess, come descritto in <a href=/articoli/installare-apache-22-php-52-mysql-5-su-windows/7/>questa pagina</a>.</p><p>La terza e la quarta riga del file .htaccess invece non sono direttamente collegata all&rsquo;utilizzo dello Zend Framework ma servono a disabilitare due funzionalità di PHP che possono comportare diversi problemi e malfunzionamenti della nostra applicazione: il register global e il magic quote.</p><hr><h3 id=il-file-di-bootstrap>Il file di bootstrap</h3><p>Finalmente possiamo iniziare ad analizzare il codice vero e proprio della nostra applicazione. Partiamo dal file index.php, il file di bootstrap al quale arrivano tutte le richieste dell&rsquo;utente. Questo file ha un compito molto importante: attivare il Front Controller, il sistema di smistamento delle richieste verso gli appositi Controller e relative Action. Poiché il file di bootstrap viene richiamato sempre e per primo, lo utilizzeremo anche per mettere le istruzioni comuni a tutta l&rsquo;applicazione. Nell&rsquo;esempio infatti attiveremo una connessione al database utilizzata (indirettamente) da quasi tutte le Action del nostro sito.</p><p>Ecco il codice:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#75715e>// includo la cartella del framework e quella dei models
</span><span style=color:#75715e></span><span style=color:#a6e22e>set_include_path</span>(<span style=color:#a6e22e>get_include_path</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>PATH_SEPARATOR</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;C:\Programmi\ZendFramework\library&#39;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>PATH_SEPARATOR</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;.\models&#39;</span>);

<span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;Zend/Loader.php&#39;</span>);

<span style=color:#a6e22e>Zend_Loader</span><span style=color:#f92672>::</span><span style=color:#a6e22e>registerAutoload</span>();

<span style=color:#a6e22e>date_default_timezone_set</span>(<span style=color:#e6db74>&#39;Europe/Rome&#39;</span>);

<span style=color:#66d9ef>try</span> {
   $db <span style=color:#f92672>=</span> <span style=color:#a6e22e>Zend_Db</span><span style=color:#f92672>::</span><span style=color:#a6e22e>factory</span>(<span style=color:#e6db74>&#39;Pdo_Mysql&#39;</span>, <span style=color:#66d9ef>array</span>(
   <span style=color:#e6db74>&#39;host&#39;</span>     <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;localhost&#39;</span>,
   <span style=color:#e6db74>&#39;username&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;root&#39;</span>,
   <span style=color:#e6db74>&#39;password&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;secret&#39;</span>,
   <span style=color:#e6db74>&#39;dbname&#39;</span>   <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;ZF-tutorial&#39;</span>
   ));

   $db<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getConnection</span>();
} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Zend_Db_Adapter_Exception</span> $e) {
   <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Zend_Db_Adapter_Exception: &#34;</span><span style=color:#f92672>.</span>$e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Zend_Exception</span> $e) {
   <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Zend_Exception&#34;</span><span style=color:#f92672>.</span>$e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
}

<span style=color:#a6e22e>Zend_Registry</span><span style=color:#f92672>::</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;db&#39;</span>, $db);

<span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;BASE_URL&#39;</span>, <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;index.php&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>,$_SERVER[<span style=color:#e6db74>&#39;PHP_SELF&#39;</span>]));
<span style=color:#a6e22e>Zend_Controller_Front</span><span style=color:#f92672>::</span><span style=color:#a6e22e>run</span>(<span style=color:#e6db74>&#39;controllers&#39;</span>);
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Analizziamo ciascuna riga del file:</p><ul><li>Con set_include_path() rendiamo accessibile alla nostra applicazione sia le classi dello Zend Framework, sia le classi contenute nella cartella models della nostra applicazione. Difficilmente infatti possiamo metter mano al php.ini e modificare l&rsquo;include_path.</li><li>Con require_once ci preoccupiamo di caricare la classe Zend_Loader, un comodo componente del Framework che si occupa di effettuare automaticamente le inclusioni dei file contenenti le classi che richiameremo nel resto dell&rsquo;applicazione. Da questo momento in poi non abbiamo più bisogno di utilizzare le istruzioni include o require!</li><li>Con Zend_Loader::registerAutoload abilitiamo la suddetta funzionalità (nessuna magia, si basa sulla funzione __autoload di PHP).</li><li>Con date_default_timezone_set() impostiamo il valore di default del timezone che verrà utilizzato implicitamente da tutte le funzioni sulle date impiegate nel codice.</li><li>All&rsquo;interno di un blocco try-catch effettuiamo la creazione di un oggetto Zend_Db_Adapter, responsabile della comunicazione con un DB. Tale operazione avviene grazie al metodo statico Zend_Db::factory al quale passiamo i parametri di connessione (modificateli per adattarli al vostro sistema). Notate come viene specificato anche il tipo di Adapter che vogliamo usare per collegarsi al database, nel nostro caso &lsquo;Pdo_Mysql&rsquo;. Zend_Db::factory ci restituirà quindi un oggetto di tipo Zend_Db_Adapter_Pdo_Mysql che al suo interno usa l&rsquo;estensione PDO per collegarsi ad un database MySQL.</li><li>$db->getConnection() effettua la vera connessione al database.</li><li>Se qualcosa va storto Zend_Db solleverà un&rsquo;eccezione, gestita dalle righe sottostanti. Un&rsquo;eccezione del tipo Zend_Db_Adapter_Exception viene sollevata se la connessione al database non ha successo (username o password errati, database irraggiungibile o spento, ecc.). Altre eccezioni possono essere sollevate, ad esempio se il framework non riesce a caricare l&rsquo;Adapter richiesto. Ecco il perché abbiamo posto un secondo blocco catch che intercetta la generica Zend_Exception.</li><li>Per rendere l&rsquo;oggetto Zend_Db_Adapter accessibile al resto dell&rsquo;applicazione, evitando di usare l&rsquo;accesso alle variabili globali, utilizziamo il componente Zend_Registry che si comporta come un &ldquo;cassetto&rdquo; nel quale conservare oggetti (Zend_Registry::set) e recuperarli all&rsquo;occorrenza (Zend_Registry::get).</li><li>Definiamo la costante BASE_URL per memorizzare l&rsquo;URL di origine della nostra applicazione web, che impiegheremo della costruzione dei template.</li><li>Infine attiviamo il Front Controller, specificando il nome della cartella contenente i Controller della nostra applicazione. A questo punto il framework istanzia il Controller adeguato ed esegue una sua Action che si occuperà di creare la pagina relativa all&rsquo;URL richiesto dall&rsquo;utente.</li></ul><p>Nel file di bootstrap abbiamo quindi incontrato i seguenti componenti del framework:</p><ul><li>Zend_Loader: responsabile del caricamento automatico &ldquo;al volo&rdquo; dei file contenenti le classi utilizzate nell&rsquo;applicazione.</li><li>Zend_Db: costruisce gli oggetti Zend_Db_Adapter che ci permettono di accedere ai database</li><li>Zend_Db_Adapter_Exception e Zend_Exception: sono 2 oggetti eccezione, il primo generato da un Zend_Db_Adapter mentre il secondo è la generica eccezione generabile dal Framework.</li><li>Zend_Registry: contenitore in grado di conservare e restituire oggetti, in modo da facilitare l&rsquo;accesso degli stessi da qualsiasi parte dell&rsquo;applicazione, senza che si faccia diretto accesso alle variabili globali</li><li>Zend_Controller_Front: il Front Controller descritto nel precedente articolo. Si occupa, insieme ad altri componenti del Framework che lavorano dietro le quinte, di leggere l&rsquo;URL richiesto dall&rsquo;utente ed identificare Controller e Action che soddisferanno tale richiesta.</li></ul></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/database/ rel=tag>database</a></li><li class=tags__item><a class="tags__link btn" href=/tags/zend-framework/ rel=tag>Zend Framework</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mysql/ rel=tag>MySQL</a></li><li class=tags__item><a class="tags__link btn" href=/tags/css/ rel=tag>CSS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/exception/ rel=tag>exception</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mod_rewrite/ rel=tag>mod_rewrite</a></li><li class=tags__item><a class="tags__link btn" href=/tags/pdo/ rel=tag>PDO</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/zend-framework-tutorial-1/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Zend Framework Tutorial - 1</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/zend-framework-tutorial-3/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Zend Framework Tutorial - 3</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//giovannitomasicchio-it.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>