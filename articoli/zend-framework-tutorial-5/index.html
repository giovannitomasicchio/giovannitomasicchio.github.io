<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Zend Framework Tutorial - 5 - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Realizzare un gestore di news con lo Zend Framework"><meta property="og:title" content="Zend Framework Tutorial - 5"><meta property="og:description" content="Realizzare un gestore di news con lo Zend Framework"><meta property="og:type" content="article"><meta property="og:url" content="https://www.giovannitomasicchio.it/articoli/zend-framework-tutorial-5/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2007-07-29T10:49:26+00:00"><meta property="article:modified_time" content="2007-07-29T10:49:26+00:00"><meta itemprop=name content="Zend Framework Tutorial - 5"><meta itemprop=description content="Realizzare un gestore di news con lo Zend Framework"><meta itemprop=datePublished content="2007-07-29T10:49:26+00:00"><meta itemprop=dateModified content="2007-07-29T10:49:26+00:00"><meta itemprop=wordCount content="1874"><meta itemprop=keywords content="database,Zend Framework,PDF,Java,CSS,email,exception,web service,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zend Framework Tutorial - 5"><meta name=twitter:description content="Realizzare un gestore di news con lo Zend Framework"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Zend Framework Tutorial - 5</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2007-07-29T10:49:26Z>29 July 2007</time></div></div></header><div class="content post__content clearfix"><h3 id=newscontroller>NewsController</h3><p>Siamo finalmente arrivati all&rsquo;ultima parte di questa serie di articoli dedicati alla realizzazione di una applicazione con lo Zend Framework. Dobbiamo analizzare il funzionamento del NewsController, il cuore della nostro sito web, che si occupa della visualizzazione, inserimento, modifica e cancellazione delle news. Di seguito viene riportata la struttura del Controller che sarà analizzata in dettaglio nelle prossime pagine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NewsController</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Zend_Controller_Action</span>
{
   <span style=color:#66d9ef>protected</span> $_flashMessenger <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>() {
       <span style=color:#75715e>// istruzioni...
</span><span style=color:#75715e></span>   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>viewAction</span>() {
       <span style=color:#75715e>// istruzioni...
</span><span style=color:#75715e></span>   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteAction</span>() {
       <span style=color:#75715e>// istruzioni...
</span><span style=color:#75715e></span>   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>newAction</span>() {
       <span style=color:#75715e>// istruzioni...
</span><span style=color:#75715e></span>   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>editAction</span>() {
       <span style=color:#75715e>// istruzioni...
</span><span style=color:#75715e></span>   }
}
</code></pre></div><p>Nel codice sono evidenti le quattro Action per la gestione delle news (viewAction, deleteAction, newAction, editAction). Inoltre si può notare l&rsquo;attributo $_flashMessenger che ci serve per conservare un riferimento all&rsquo;helper FlashMessenger, descritto nel precedente articolo. Poiché il FlashMessenger viene utilizzato in quasi tutte le Action, è conveniente recuperarlo e conservarlo in un attributo (una variabile) del Controller. Dove vanno poste le istruzioni per recuperare il FlashMessenger indipendentemente dalla Action chiamata? Nel metodo <strong>init()</strong>, di seguito riportato:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>()
{
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_helper</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getHelper</span>(<span style=color:#e6db74>&#39;FlashMessenger&#39;</span>);

   <span style=color:#66d9ef>if</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_hasParam</span>(<span style=color:#e6db74>&#39;annulla&#39;</span>)) {
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
   }
}
</code></pre></div><p>Il metodo init() è una particolare funzione che è possibile inserire in un Controller. Se presente, viene eseguito prima di qualsiasi Action richiesta dall&rsquo;utente, quindi risulta utile quando vogliamo lanciare delle istruzioni comuni a tutte le Action, senza doverle ripetere in ciascuna di esse. Nel nostro caso il metodo init() è stato utilizzato proprio per conservare un riferimento al FlashMessenger nell&rsquo;attributo $this->_flashMessenger.</p><p>Inoltre due Action del Controller (quelle che gestiscono l&rsquo;inserimento e la modifica di una news) prevedono che l&rsquo;operazione possa essere annullata attraverso la pressione di un tasto &ldquo;annulla&rdquo;, presente nel form. Anche la gestione di questo comportamento comune quindi può essere &ldquo;centralizzata&rdquo; nel metodo init() in modo da non doverla ripetere (ricopiare) nelle due Action.</p><p>Per sapere se è presente un parametro tra i dati inviati con il form utilizziamo l&rsquo;istruzione <strong>$this->_hasParam(&lsquo;nome_parametro&rsquo;)</strong>. Nel nostro caso il pulsante di annullamento è un classico bottone di submit e ha per nome &lsquo;annulla&rsquo;. Per effettuare il redirect utilizziamo invece <strong>$this->_redirect('/URL/di/destinazione')</strong>. Corrisponde al classico header(&lsquo;location: /URL/di/destinazione&rsquo;);</p><hr><h3 id=viewaction>viewAction</h3><p>Se l&rsquo;utente clicca sul titolo di una news in home page, il sito mostra una pagina contenente il testo completo della news selezionata. Per identificare univocamente la news di interesse abbiamo creato il link associato nella forma /news/view/id/news_id dove news_id è il valore della chiave primaria della tabella delle news. Come si può vedere dal codice del metodo viewAction, per recuperare questo valore usiamo la funzione <strong>$this->_getParam(&lsquo;id&rsquo;)</strong> che ricorda il metodo $this->_hasParam visto nella pagina precedente.</p><p>In realtà il metodo $this->_getParam(&lsquo;nome_parametro&rsquo;) è una scorciatoia che equivale al più prolisso <strong>$this->getRequest()->getParam(&lsquo;nome_parametro&rsquo;)</strong>. Cosa fa <strong>$this->getRequest()</strong>? Ci restituisce l'<strong>oggetto Request</strong>, costruito dallo Zend Framework per contenere tutti i dati associati alla richiesta corrente dell&rsquo;utente: il nome del Controller, il nome della Action, le coppie nome/valore presenti nell&rsquo;URL e tutti gli eventuali parametri contenuti in $_GET, $_POST, $_COOKIE, $_SERVER e $_ENV. In poche parole tutti i dati provenienti dall&rsquo;estero, dall&rsquo;utente, vengono racchiusi automaticamente dallo Zend Framework nell&rsquo;oggetto Request (similmente a ciò che avviene in una servlet del Java). Tutti questi dati sono nella forma chiave=>valore quindi potenzialmente si sovrappongono l&rsquo;uno con l&rsquo;altro (a parità di chiave) secondo l&rsquo;ordine in cui sono stati elencati, similmente a quello che avviene nell&rsquo;array $_REQUEST. Se però si vuole recuperare esattamente un particolare parametro, ad esempio proveniente dall&rsquo;array $_POST, allora si può usare <strong>$request->getPost(&lsquo;nome_parametro&rsquo;)</strong> dove $request è ovviamente l&rsquo;oggetto Request ottenuto nel Controller attraverso $this->getRequest().</p><p>E' evidente che lo Zend Framework vuole che lo sviluppatore non acceda direttamente alle variabili superglobali ma che lo faccia attraverso l&rsquo;oggetto Request. In questo modo tutti i dati provenienti dall&rsquo;esterno sono raggruppati in un unico oggetto e sono accessibili tutti allo stesso modo, indipendentemente dalla loro particolare provenienza. Inoltre così si evita di modificare involontariamente uno di questi dati (if ($_POST[&lsquo;parametro&rsquo;] = &lsquo;valore&rsquo;) al posto di if ($_POST[&lsquo;parametro&rsquo;] == &lsquo;valore&rsquo;)).</p><p>E' bene precisare comunque che l&rsquo;oggetto Request non filtra in alcun modo i dati in esso conservati, operazione affidata ad altri componenti del framework che in questo tutorial non abbiamo considerato.</p><p>Chiarito le modalità di accesso ai dati provenienti dall&rsquo;esterno vediamo il codice dell&rsquo;Action che mostra una news all&rsquo;utente:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>viewAction</span>()
{
   $news <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>News</span>();

   $newsId <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_getParam</span>(<span style=color:#e6db74>&#39;id&#39;</span>);
   $news <span style=color:#f92672>=</span> $news<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getNewsById</span>($newsId);

   <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$news) {
       <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Controller_Action_Exception</span>;
   }

   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>titoloPagina</span> <span style=color:#f92672>=</span> $news[<span style=color:#e6db74>&#39;titolo&#39;</span>];
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>news</span> <span style=color:#f92672>=</span> $news;
}
</code></pre></div><p>Tutte le istruzioni dovrebbero ormai essere chiare, tranne che per l&rsquo;eccezione sollevata nel caso in cui il metodo getNewsById() del Model non restituisce alcun risultato. Se questo avviene significa che l&rsquo;id della news recuperato dall&rsquo;URL non corrisponde ad una news memorizzata nel database. Questo problema viene gestito simulando un errore di &ldquo;pagina non trovata&rdquo;. L&rsquo;eccezione <strong>Zend_Controller_Action_Exception</strong> interrompe l&rsquo;esecuzione di viewAction() e risale fino al Front Controller (o meglio fino al dispatcher) che reagisce richiamando l&rsquo;ErrorController che a sua volta mostrata una pagina di errore. L&rsquo;ErrorController quindi, oltre ad essere richiamato automaticamente dal framework, può essere invocato in maniera programmatica da qualunque altro Controller, nel modo appena visto.</p><p>Terminata l&rsquo;esecuzione della viewAction, per le convenzioni sui nomi dei template, viene automaticamente caricato il template /views/scripts/news/view.phtml, riportato di seguito.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;header.phtml&#39;</span>); <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>&lt;div class=&#34;news&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;div class=&#34;autore&#34;&gt;di &lt;?php echo $this-&gt;escape($this-&gt;news[&#39;autore&#39;]) ?&gt; | &lt;?php echo $this-&gt;escape($this-&gt;news[&#39;data&#39;]) ?&gt;&lt;/div&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;div class=&#34;modifica&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;a href=&#34;&lt;?php echo BASE_URL?&gt;news/edit/id/&lt;?php echo $this-&gt;escape($this-&gt;news[&#39;news_id&#39;]) ?&gt;/&#34;&gt;Modifica&lt;/a&gt;
</span><span style=color:#960050;background-color:#1e0010>       -
</span><span style=color:#960050;background-color:#1e0010>       &lt;a href=&#34;&lt;?php echo BASE_URL?&gt;news/delete/id/&lt;?php echo $this-&gt;escape($this-&gt;news[&#39;news_id&#39;]) ?&gt;/&#34;&gt;Cancella&lt;/a&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/div&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;div class=&#34;testo&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;?php echo nl2br($this-&gt;escape($this-&gt;news[&#39;testo_intro&#39;])) ?&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;?php echo nl2br($this-&gt;escape($this-&gt;news[&#39;testo_completo&#39;])) ?&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/div&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;/div&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;a href=&#34;&lt;?php echo BASE_URL?&gt;&#34;&gt;&amp;lt;&amp;lt; Indietro&lt;/a&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;?php echo $this-&gt;render(&#39;footer.phtml&#39;); ?&gt;
</span></code></pre></div><hr><h3 id=deleteaction>deleteAction</h3><p>L&rsquo;Action che effettua la cancellazione di una news ha una struttura molto semplice. Istanzia il Model delle News, recupera dall&rsquo;URL l&rsquo;id della news da cancellare, lo passa al Model per l&rsquo;effettiva cancellazione dal database, memorizza nel flashMessenger un messaggio di avvenuta cancellazione ed infine effettua il redirect alla home page del sito.</p><p>Ovviamente la presenza del redirect inibisce il caricamento automatico di un template al termine della Acion.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>deleteAction</span>()
{
   $news <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>News</span>();
   $newsId <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_getParam</span>(<span style=color:#e6db74>&#39;id&#39;</span>);
   $news<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>deleteNews</span>($newsId);
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#34;Cancellazione della news avvenuta con successo&#34;</span>);
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
}
</code></pre></div><hr><h3 id=newaction>newAction</h3><p>La Action che si occupa di inserire una nuova news nel database ha una struttura particolare, che rende le poche righe di codice che la costituiscono davvero efficienti. Infatti newAction deve mostrare il form di inserimento, inserire la news se tutti i dati inviati sono corretti e mostrare nuovamente il form con i dati precedentemente inseriti se questi non sono corretti. Analizziamone il funzionamento.</p><p>In qualunque situazione ci troviamo assegnamo il titolo alla pagina e specifichiamo il nome del template da mostrare (righe 3 e 6). Infatti il template usato per inserire o modificare una news è unico, quindi non potrà rispettare la convenzione sui nomi e di conseguenza non verrebbe caricato automaticamente. La riga 6 serve proprio a specificare un template diverso da quello che l&rsquo;oggetto <strong>viewRenderer</strong>, responsabile del caricamento automatico dei template, si sarebbe aspettato.</p><p>Se è stato effettuato l&rsquo;invio del form (<strong>$request->isPost()</strong> in riga 9) allora dobbiamo provare ad inserire la nuova news nel database. Recuperiamo quindi i dati inseriti dall&rsquo;utente con $request->getPost(&lsquo;nome_parametro&rsquo;) ed invochiamo il metodo insertUpdateNews del Model $news (riga 19). Se tutto va bene memorizziamo un messaggio di successo nel flashMessenger ed effettuiamo il redirect alla home page. Se invece il Model $news solleva un&rsquo;eccezione a causa di un problema con i dati inseriti dall&rsquo;utente, allora mostro un messaggio di errore (riga 23) insieme ai dati inviati dall&rsquo;utente (righe 24-27)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>newAction</span>()
{
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>titoloPagina</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Inserisci una news&#39;</span>;

   <span style=color:#75715e>// Utilizza &#39;news/news-form.phtml&#39; invece di  &#39;news/new.phtml&#39;
</span><span style=color:#75715e></span>   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_helper</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>viewRenderer</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setScriptAction</span>(<span style=color:#e6db74>&#39;news-form&#39;</span>);

   $request <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRequest</span>();
   <span style=color:#66d9ef>if</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isPost</span>())
   {
       $news <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>News</span>;

       $autore        <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;autore&#39;</span>);
       $titolo        <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;titolo&#39;</span>);
       $testoIntro    <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;testo_intro&#39;</span>);
       $testoCompleto <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;testo_completo&#39;</span>);

       <span style=color:#66d9ef>try</span> {
           $news<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>insertUpdateNews</span>(<span style=color:#66d9ef>false</span>,$autore,$titolo,$testoIntro,$testoCompleto);
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#34;News &#39;</span><span style=color:#e6db74>$titolo</span><span style=color:#e6db74>&#39; memorizzata con successo&#34;</span>);
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
       } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Zend_Exception</span> $e) {
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>errorMsg</span> <span style=color:#f92672>=</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>();
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>news</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;autore&#39;</span> <span style=color:#f92672>=&gt;</span> $autore,
           <span style=color:#e6db74>&#39;titolo&#39;</span>        <span style=color:#f92672>=&gt;</span> $titolo,
           <span style=color:#e6db74>&#39;testo_intro&#39;</span>   <span style=color:#f92672>=&gt;</span> $testoIntro,
           <span style=color:#e6db74>&#39;testoCompleto&#39;</span> <span style=color:#f92672>=&gt;</span> $testoCompleto);
       }
   }
}
</code></pre></div><p>Di seguito è riportato il codice del template utilizzato per l&rsquo;inserimento e la modifica di una news. Si noti l&rsquo;utilizzo dei metodi <strong>$this->formText</strong> e <strong>$this->formTextarea</strong>, appartenenti alla categoria dei <strong>View Helpers</strong>, che servono a creare dinamicamente i campi di inserimento dati del form. Questi metodi accettano tre parametri: il nome del controllo (l&rsquo;attributo name), il contenuto del controllo (l&rsquo;attributo value, che non necessita di escape!) e un array contenente una o più coppie &ldquo;nome_attributo&rdquo;=>&ldquo;valore&rdquo;. Nel nostro esempio questo array viene utilizzato per specificare una classe CSS.</p><p><strong>news-form.phtml</strong></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>render</span>(<span style=color:#e6db74>&#39;header.phtml&#39;</span>); <span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010>&lt;p class=&#34;errore&#34;&gt;&lt;?php echo $this-&gt;escape($this-&gt;errorMsg)?&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;form action=&#34;&#34; method=&#34;post&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;fieldset&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;legend&gt;Dati della news&lt;/legend&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;p&gt;&lt;label&gt;Autore*:&lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>           &lt;?php echo $this-&gt;formText(&#39;autore&#39;, $this-&gt;news[&#39;autore&#39;], array(&#39;class&#39;=&gt;&#39;inputForm&#39;)) ?&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;/label&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;p&gt;&lt;label&gt;Titolo*:&lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>           &lt;?php echo $this-&gt;formText(&#39;titolo&#39;, $this-&gt;news[&#39;titolo&#39;], array(&#39;class&#39;=&gt;&#39;inputForm&#39;)) ?&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;/label&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;p&gt;&lt;label&gt;Testo introduttivo*:&lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>           &lt;?php echo $this-&gt;formTextarea(&#39;testo_intro&#39;, $this-&gt;news[&#39;testo_intro&#39;],array(&#39;rows&#39; =&gt; 5,&#39;cols&#39;=&gt;50)) ?&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;/label&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;p&gt;&lt;label&gt;Testo completo:&lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>           &lt;?php echo $this-&gt;formTextarea(&#39;testo_completo&#39;, $this-&gt;news[&#39;testo_completo&#39;],array(&#39;rows&#39; =&gt; 5,&#39;cols&#39;=&gt;50)) ?&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;/label&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;p&gt;* campo obbligatorio&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;div class=&#34;buttons&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>           &lt;input type=&#34;submit&#34; name=&#34;annulla&#34; value=&#34;Annulla&#34; /&gt;&lt;input type=&#34;submit&#34; name=&#34;invia&#34; value=&#34;Invia&#34; /&gt;
</span><span style=color:#960050;background-color:#1e0010>       &lt;/div&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/fieldset&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;/form&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;?php echo $this-&gt;render(&#39;footer.phtml&#39;); ?&gt;
</span></code></pre></div><hr><h3 id=editaction>editAction</h3><p>La Action per la modifica di una news precedentemente inserita dall&rsquo;utente ha una struttura molto simile a quella per l&rsquo;inserimento vista nella precedente pagina. La principale differenza consiste nel fatto che se la pagina viene mostrata per la prima volta non basta caricare il template del form di inserimento/modifica ma bisogna anche recuperare i dati della news dal database e passarli al template. Queste operazioni vengono realizzate alla fine dello script, nel blocco &ldquo;else&rdquo; (righe 34-38). Si noti come anche in questo caso viene effettuato un controllo sulla news recuperata dal database. Infatti poiché l&rsquo;id della news proviene dall&rsquo;utente, questo potrebbe esser manomesso e quindi non associato ad una news realmente presente nel database. In questo caso viene sollevata una eccezzione che si traduce, come visto nella viewAction, in un messaggio di pagina non trovata.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>editAction</span>()
{
   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>titoloPagina</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Modifica news&#39;</span>;

   <span style=color:#75715e>// Utilizza il template &#39;news/news-form.phtml&#39; al posto di  &#39;news/edit.phtml&#39;
</span><span style=color:#75715e></span>   $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_helper</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>viewRenderer</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setScriptAction</span>(<span style=color:#e6db74>&#39;news-form&#39;</span>);

   $news <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>News</span>;

   $request <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getRequest</span>();
   $newsId  <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getParam</span>(<span style=color:#e6db74>&#39;id&#39;</span>);
   <span style=color:#66d9ef>if</span>($request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>isPost</span>())
   {
       $autore        <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;autore&#39;</span>);
       $titolo        <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;titolo&#39;</span>);
       $testoIntro    <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;testo_intro&#39;</span>);
       $testoCompleto <span style=color:#f92672>=</span> $request<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getPost</span>(<span style=color:#e6db74>&#39;testo_completo&#39;</span>);

       <span style=color:#66d9ef>try</span> {
           $news<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>insertUpdateNews</span>($newsId,$autore,$titolo,$testoIntro,$testoCompleto);
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#34;News &#39;</span><span style=color:#e6db74>$titolo</span><span style=color:#e6db74>&#39; modificata con successo&#34;</span>);
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
       } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Zend_Exception</span> $e) {
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>errorMsg</span> <span style=color:#f92672>=</span> $e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>();
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>news</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>($autore,$titolo,$testoIntro,$testoCompleto);
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>news</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;autore&#39;</span> <span style=color:#f92672>=&gt;</span> $autore,
           <span style=color:#e6db74>&#39;titolo&#39;</span>        <span style=color:#f92672>=&gt;</span> $titolo,
           <span style=color:#e6db74>&#39;testo_intro&#39;</span>   <span style=color:#f92672>=&gt;</span> $testoIntro,
           <span style=color:#e6db74>&#39;testoCompleto&#39;</span> <span style=color:#f92672>=&gt;</span> $testoCompleto);
       }
   }
   <span style=color:#66d9ef>else</span>
   {
       $news <span style=color:#f92672>=</span> $news<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getNewsById</span>($newsId);
       <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$news) {
           <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Controller_Action_Exception</span>;
       }
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>news</span> <span style=color:#f92672>=</span> $news;
   }
}
</code></pre></div><hr><h3 id=conclusioni>Conclusioni</h3><p>Si conclude qui il nostro breve viaggio all&rsquo;interno dello Zend Framework, un potente strumento che esalta le caratteristiche di PHP e lo rende adeguato alla realizzazione di applicazioni complesse senza dover rinunciare alla semplicità a cui siamo abituati. Forse chi non ha mai utilizzato framework così ambiziosi si sarà trovato in difficoltà nel seguire il percorso si qui fatto ma con un po' di pratica tutto risulterà più immediato.</p><p>Vale la pena ricordare che i componenti utilizzati nella nostra applicazione di esempio sono solo una minima parte di quelli offerti dallo Zend Framework ma, a differenza degli altri, sono quelli che ne costituiscono l&rsquo;architettura e che quindi sono il fondamento di qualunque applicazione. Data la natura del framework, tutti i componenti che non abbiamo citato (autenticazione, autorizzazione, pdf, email, internazionalizzazione, web services, ecc.) potranno essere studiati separatamente ed impiegati all&rsquo;occorrenza, senza che il cuore dell&rsquo;applicazione realizzata venga stravolto.</p><p>Anche se sono in cantiere ulteriori articoli sullo Zend Framework, da questo momento è d&rsquo;obbligo far riferimento alla documentazione ufficiale per approfondire ed ampliare la propria conoscenza di questo ottimo strumento.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/database/ rel=tag>database</a></li><li class=tags__item><a class="tags__link btn" href=/tags/zend-framework/ rel=tag>Zend Framework</a></li><li class=tags__item><a class="tags__link btn" href=/tags/pdf/ rel=tag>PDF</a></li><li class=tags__item><a class="tags__link btn" href=/tags/java/ rel=tag>Java</a></li><li class=tags__item><a class="tags__link btn" href=/tags/css/ rel=tag>CSS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/email/ rel=tag>email</a></li><li class=tags__item><a class="tags__link btn" href=/tags/exception/ rel=tag>exception</a></li><li class=tags__item><a class="tags__link btn" href=/tags/web-service/ rel=tag>web service</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/zend-framework-tutorial-4/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Zend Framework Tutorial - 4</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/autenticare-gli-utenti-con-zend-auth-1/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Autenticare gli utenti con Zend_Auth - 1</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//giovannitomasicchio-it.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>