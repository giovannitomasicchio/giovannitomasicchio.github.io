<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Introduzione all'utilizzo di MongoDB in PHP - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Utilizzare il database orientato ai documenti MongoDB nelle applicazioni PHP"><meta property="og:title" content="Introduzione all'utilizzo di MongoDB in PHP"><meta property="og:description" content="Utilizzare il database orientato ai documenti MongoDB nelle applicazioni PHP"><meta property="og:type" content="article"><meta property="og:url" content="https://www.giovannitomasicchio.it/articoli/introduzione-all'utilizzo-di-mongodb-in-php/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2012-11-16T12:44:31+00:00"><meta property="article:modified_time" content="2012-11-16T12:44:31+00:00"><meta itemprop=name content="Introduzione all'utilizzo di MongoDB in PHP"><meta itemprop=description content="Utilizzare il database orientato ai documenti MongoDB nelle applicazioni PHP"><meta itemprop=datePublished content="2012-11-16T12:44:31+00:00"><meta itemprop=dateModified content="2012-11-16T12:44:31+00:00"><meta itemprop=wordCount content="2455"><meta itemprop=keywords content="database,MongoDB,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Introduzione all'utilizzo di MongoDB in PHP"><meta name=twitter:description content="Utilizzare il database orientato ai documenti MongoDB nelle applicazioni PHP"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Introduzione all'utilizzo di MongoDB in PHP</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2012-11-16T12:44:31Z>16 November 2012</time></div></div></header><div class="content post__content clearfix"><p>Quasi ogni applicazione deve gestisce un archivio dati. Lo può fare in svariati modi ma il più comune è l&rsquo;utilizzo di un database relazionale gestito tramite qualche noto DBMS: Oracle, MySQL, SQL Server, PostgreSQL, etc..</p><p>Parlare di database relazionali richiama subito alla memoria alcuni concetti fondamentali quali tabelle, relazioni, linguaggio SQL, ecc.. Essenzialmente un database relazionale può essere visto come un sistema strutturato per la conservazione ed il reperimento di dati, memorizzati all&rsquo;interno di tabelle collegate tra loro da relazioni. Se predisposta bene, questa “infrastruttura” ci permette, attraverso il linguaggio SQL, di svolgere operazioni di aggregazione e filtraggio dei dati, anche molto complesse.</p><p>L&rsquo;informatica attuale, fortemente condizionata dal mondo dei servizi Internet e dei social network, è chiamata a prendersi cura di moli sempre più imponenti di informazioni, collezionate con grande velocità da milioni di utenti. Ciò che spesso <strong>manca</strong> a questi dati raccolti è la possibilità di essere inquadrati in <strong>una struttura</strong>.</p><p>Nel mondo “relazionale” la strutturazione dei dati, definita in fase di progettazione delle tabelle, ha un ruolo dominante ed è l&rsquo;elemento che prepara la strada all&rsquo;azione del linguaggio SQL. Da alcuni anni però si stanno diffondendo soluzioni che impiegano un diverso approccio alla gestione della persistenza dei dati, finalizzato alla concentrazione di <strong>dati non strutturati</strong> che, pertanto, non possono fare uso del linguaggio SQL.</p><p>Questi prodotti, detti NoSQL, oggi costituiscono già un universo variegato. Il modo più pratico per approcciarne lo studio è raggrupparli per categorie.</p><p>Le principali, almeno come numero di prodotti che ne fanno parte, sono:</p><ul><li>document-oriented, tra cui MongoDB, oggetto di questo articolo;</li><li>a grafo;</li><li>chiave/valore archiviato su disco;</li><li>ad oggetti.</li></ul><p>MongoDB è uno dei più famosi database basati sui documenti, viene attualmente utilizzato in sistemi di produzione e deve la sua precoce fama a caratteristiche come:</p><ul><li>la sua natura open source e multipiattaforma;</li><li>l&rsquo;alta disponibilità di driver per l&rsquo;interazione con diversi linguaggi;</li><li>propensione ad un&rsquo;installazione scalabile su infrastrutture distribuite (auto-sharding, replicazione, implementazione dell&rsquo;algoritmo MapReduce).</li></ul><hr><h2 id=installazione-di-mongodb>Installazione di MongoDB</h2><p>Dopo questa breve introduzione al mondo del NoSQL, vediamo adesso come preparare il nostro PC all’utilizzo di MongoDB. Il punto di partenza è l&rsquo;installazione del DBMS al termine della quale avremo a disposizione due strumenti: il programma <strong>mongod</strong> che rappresenta il server vero e proprio e l&rsquo;utility <strong>mongo</strong> ossia il client da riga di comando.</p><p><strong>In Windows</strong> è sufficiente scaricare il pacchetto della versione desiderata da <a href=http://www.mongodb.org/downloads>www.mongodb.org/downloads</a> e scompattare l&rsquo;archivio in una cartella di preferenza, ad esempio <code>&lt;kbd>C:\mongodb&lt;/kbd></code>. Essa conterrà una directory “bin” con gli eseguibili sopra citati ed altre utility. Fatto ciò bisogna creare la cartella <code>C:\data</code> ed al suo interno <code>C:\data\db</code>. Questi sono i percorsi di default utilizzati dal server per memorizzare i dati.</p><p><strong>In una distribuzione GNU/Linux</strong>, sarà possibile procedere all&rsquo;installazione tramite pacchetti precompilati. Ad esempio in un sistema Debian 6.0 basta lanciare il comando <code># aptitude install mongo</code>. I comandi <code>mongod</code> e <code>mongo</code> saranno presenti nella cartella <code>/usr/bin</code> già utilizzabili da riga di comando.</p><p>A questo punto basta avviare mongod (su Windows basta eseguire <strong>mongod.exe</strong> da riga di comando) per avere il server disponibile in rete all&rsquo;indirizzo IP locale della macchina (il classico localhost 127.0.0.1) ed alla porta TCP 27017. Altre configurazioni come file destinazione dei log, cartelle di storage dei database, autenticazione e molte altre di natura più sistemistica non vengono trattate in questo articolo ma sono ottenibili seguendo le indicazioni fornite dalla documentazione ufficiale presente su <a href=http://www.mongodb.org/>www.mongodb.org</a>.</p><p><img src=/image/articoli/introduzione-mongodb/avvio-server.png alt></p><p>Una volta avviato il server MongoDB, è necessario fare in modo che il linguaggio PHP abbia gli strumenti giusti per interagirvi. Stiamo parlando del “driver” ossia della libreria che traduce, nella lingua parlata dal server, i comandi che si vogliono impartire. I driver di MongoDB sono disponibili sul sito del progetto al link: <a href=http://www.mongodb.org/display/DOCS/Drivers>www.mongodb.org/display/DOCS/Drivers</a>.</p><p>Per l&rsquo;interazione con il linguaggio PHP è necessario scaricare l&rsquo;estensione adatta al nostro sistema (php_mongo.dll per Windows), copiarla nella cartella delle estensioni di PHP e modificare il file php.ini aggiungendo la direttiva <code>extension=php_mongo.dll</code>. Anche questo aspetto è dettagliatamente riportato nella documentazione del sito di MongoDB. Coloro che utilizzano Zend Server devono invece limitarsi ad abilitare l’estensione mongo dall’interfaccia web di configurazione.</p><hr><p>Una volta che il server è installato ed avviato è possibile dialogarvi utilizzando il client <em>mongo</em> che offre una console interattiva. Ma prima dobbiamo prendere confidenza con la terminologia adottata da MongoDB.</p><p>Mentre in un sistema relazionale l&rsquo;architettura dell&rsquo;informazione poggia sulle tabelle che compongono il database, in un sistema orientato ai documenti come MongoDB tutta l&rsquo;architettura si riduce al <strong>documento</strong>, che sostituisce il record di un RDBMS tradizionale.</p><p>Un documento è un insieme di <strong>campi</strong>, ciascuno costituito da una coppia <strong>chiave -> valore</strong>. La chiave è una stringa (ricorda il nome della colonna di una tabella) mentre il valore può essere un tipo semplice (intero, decimale, stringa, ecc.), un array di tipi semplici o un intero documento. Per descrivere questa struttura dati, potenzialmente assai più complessa di quella del record tradizionale, MongoDB utilizza la notazione <strong>JSON</strong>.</p><p><strong>Ogni documento potrà avere un proprio insieme di campi</strong>, una propria struttura, ed avere in comune con altri documenti solo l&rsquo;appartenenza alla medesima <strong>collection</strong>.</p><p>La collection quindi è un insieme di documenti, così come la tabella è un insieme di record. Questa però non svolge più il forte ruolo normativo della tabella relazionale (specifica del numero di campi, tipi di dato, vincoli sui valori accettati) ma serve per lo più da accumulatore di documenti, potenzialmente molto eterogenei tra loro.</p><p>I concetti appena espressi portano, da un lato, alla definizione di una struttura dati estremamente flessibile, dall’altro, all’impossibilità di impiegare l’SQL come linguaggio per interagire col database. Al suo posto troveremo JSON e una sintassi in stile <strong>Javascript</strong>.</p><p>Infine in MongoDB un <strong>database</strong> è un insieme di collection, similmente a quanto accade in un database relazionale, costituito da un insieme di tabelle.</p><p>Lo specchietto seguente riassume la corrispondenza che si può individuare tra i concetti che regolano un tradizionale database relazionale e MongoDB:</p><table><thead><tr><th>RDBMS</th><th>MongoDB</th></tr></thead><tbody><tr><td>database</td><td>database</td></tr><tr><td>tabella</td><td>collection</td></tr><tr><td>record (tupla o riga della tabella)</td><td>documento</td></tr><tr><td>colonna della tabella</td><td>campo del documento</td></tr><tr><td>indice</td><td>indice</td></tr><tr><td>SQL</td><td>JSON, Javascipt</td></tr></tbody></table><hr><h2 id=database-di-esempio>Database di esempio</h2><p>Nel seguito dell&rsquo;articolo si immaginerà di gestire in MongoDB un sistema di reclutamento di personale per un&rsquo;azienda che richiede al candidato la conoscenza di almeno uno tra i linguaggi di programmazione Java e PHP. Queste informazioni, insieme a quelle relative ad ogni altra competenza del candidato in materia informatica o linguistica, verranno conservate nel db e classificate con una valutazione da 1 a 10.</p><p>A titolo di esempio, il sistema conserverà in documenti appartenenti alla stessa collezione, sia i dati del signor Ugo Rossi, competente in Java e PHP con le rispettive valutazioni di 10 e 7 e con un&rsquo;abilità nella lingua inglese valutata anch&rsquo;essa in 7/10, sia i dati del signor Silvio Verdi esperto di PHP e Python (entrambi voto 8) ma a conoscenza solo di pochi elementi della lingua inglese (voto 5).</p><p>Come anticipato, il formato usato da MongoDB per descrivere questi documenti è JSON. I dati dell&rsquo;esempio corrisponderanno agli array JSON:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
 <span style=color:#f92672>&#34;nome&#34;</span>    : <span style=color:#e6db74>&#34;Ugo&#34;</span>,
 <span style=color:#f92672>&#34;cognome&#34;</span> : <span style=color:#e6db74>&#34;rossi&#34;</span>,
 <span style=color:#f92672>&#34;Java&#34;</span>    : <span style=color:#e6db74>&#34;10&#34;</span>,
 <span style=color:#f92672>&#34;PHP&#34;</span>     : <span style=color:#e6db74>&#34;7&#34;</span>,
 <span style=color:#f92672>&#34;inglese&#34;</span> : <span style=color:#e6db74>&#34;7&#34;</span>
}
</code></pre></div><p>e</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
 <span style=color:#f92672>&#34;nome&#34;</span>    : <span style=color:#e6db74>&#34;Silvio&#34;</span>,
 <span style=color:#f92672>&#34;cognome&#34;</span> : <span style=color:#e6db74>&#34;Verdi&#34;</span>,
 <span style=color:#f92672>&#34;Python&#34;</span>  : <span style=color:#e6db74>&#34;8&#34;</span>,
 <span style=color:#f92672>&#34;PHP&#34;</span>     : <span style=color:#e6db74>&#34;8&#34;</span>,
 <span style=color:#f92672>&#34;inglese&#34;</span> : <span style=color:#e6db74>&#34;5&#34;</span>
}
</code></pre></div><p>Iniziamo a trattare questi dati in MongoDB facendo uso delle fondamentali operazioni fornite dalla console.</p><p>Per fare ciò avviamo il client mongo specificando indirizzo IP, porta TCP e nome del database (in questo caso denominato “prova”).</p><p><img src=/image/articoli/introduzione-mongodb/connessione-server.png alt></p><p>Si noti che non è richiesta l’esistenza del database a cui ci stiamo connettendo. Qualora richiedessimo la connessione ad un database non ancora esistente, Mongo lo creerà per noi, svolgendo una versione NoSQL del tradizionale CREATE DATABASE. Nel seguito vedremo come accadrà lo stesso per la creazione di una collection.</p><p>Adesso proviamo ad inserire i dati dei signori Rossi e Verdi in MongoDB e poi chiediamo al server di restituirceli con una ricerca:</p><pre><code>
&gt; db.candidati.insert({nome: &quot;ugo&quot;,cognome: &quot;rossi&quot;,Java: &quot;10&quot;,PHP: &quot;7&quot;,inglese: &quot;7&quot;})
&gt; db.candidati.insert({nome: &quot;Silvio&quot;,cognome: &quot;Verdi&quot;,Python: &quot;8&quot;,PHP: &quot;8&quot;,inglese: &quot;5&quot;})
&gt; db.candidati.find()
{ &quot;_id&quot; : ObjectId(&quot;505335a0678b1ec66db608d3&quot;), &quot;nome&quot; : &quot;ugo&quot;, &quot;cognome&quot; : &quot;rossi&quot;, &quot;Java&quot; : &quot;10&quot;, &quot;PHP&quot; : &quot;7&quot;, &quot;inglese&quot; : &quot;7&quot; }
{ &quot;_id&quot; : ObjectId(&quot;505335b9678b1ec66db608d4&quot;), &quot;nome&quot; : &quot;Silvio&quot;, &quot;cognome&quot; : &quot;Verdi&quot;, &quot;Python&quot; : &quot;8&quot;, &quot;PHP&quot; : &quot;8&quot;, &quot;inglese&quot; : &quot;5&quot; }
</code></pre><p>Quello che è appena successo, in SQL, corrisponderebbe a due INSERT ed una SELECT. In termini NoSQL lo spieghiamo dicendo che sono stati inseriti nella collection “candidati” due documenti riportanti rispettivamente le competenze del sig. Ugo Rossi e del sig. Silvio Verdi, e poi ne è stato visualizzato il contenuto con il comando <strong>find</strong>.</p><p>Osservazioni importanti:</p><ul><li>i comandi iniziano sempre con “db.” che fa riferimento al database corrente;</li><li>la collection &ldquo;candidati&rdquo; non esiste ancora ma al primo inserimento di un documento viene creata in automatico;</li><li>la chiave primaria non è stata inserita direttamente ma, osservando l&rsquo;output del find(), si vede che ogni documento ha un suo _id che costituisce un identificativo univoco del documento creato automaticamente dal server.</li></ul><hr><h2 id=interazione-php---mongodb>Interazione PHP - MongoDB</h2><p>Procediamo adesso con un esempio piuttosto basilare, finalizzato a trasformare in un programma PHP quanto precedentemente effettuato da riga di comando.</p><p>Per connetterci al database è necessario istanziare un oggetto della classe Mongo, passandogli una stringa contenente i parametri di connessione. Nel nostro caso, non avendo provvisto MongoDB di autenticazione, sarà sufficiente richiedere una connessione al servizio standard ossia localhost sulla porta 27017.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
$conn <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Mongo</span>(<span style=color:#e6db74>&#34;mongodb://localhost:27017&#34;</span>);
$database <span style=color:#f92672>=</span> $conn<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>prova</span>;
$collection <span style=color:#f92672>=</span> $database<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>candidati</span>;
</code></pre></div><p>Nell&rsquo;esempio la variabile $conn contiene la connessione attiva al DBMS. Da lì si ottiene un riferimento al database “prova” ($database è un oggetto di tipo MongoDB) e poi alla collection “candidati” ($collection è un oggetto di tipo MongoCollection). Come già detto, se il database o la collection non esistono ancora, MongoDB non restituisce alcun errore ma li crea automaticamente.</p><p>Come anticipato, MongoDB non adotta un linguaggio per le query simile all’SQL. Al suo posto dobbiamo utilizzare i metodi dell’oggetto MongoCollection a cui passeremo degli array opportunamente configurati. Sarà poi il driver di Mongo a convertirli in comandi e strutture JSON, analoghi a quelli illustrati nelle operazioni da riga di comando.</p><p>Ecco un esempio di inserimento di un documento:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$documento <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span> (
    <span style=color:#e6db74>&#39;nome&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Ugo&#34;</span>,
    <span style=color:#e6db74>&#39;cognome&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;Rossi&#34;</span>,
    <span style=color:#e6db74>&#39;PHP&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>7</span>,
    <span style=color:#e6db74>&#39;Java&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>10</span>,
    <span style=color:#e6db74>&#39;inglese&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>7</span>
);

$collection<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>insert</span>($documento);
</code></pre></div><p>L’array $documento contiene i dati del signor Ugo Rossi da inserire nel database. Nel mondo relazionale costituirebbe un record di una tabella, in MongoDB invece costituisce un documento. Il metodo insert invocato sulla collection svolge il lavoro.</p><p>E’ estremamente importante fare attenzione al set di caratteri utilizzato dalle stringhe inserite in un documento. <strong>In tutte le funzioni di MongoDB va utilizzato l’UTF-8</strong>. Nel caso lo script realizzato non tratti stringhe in UTF-8 è possibile convertirli usando la funzione utf8_encode.</p><p>Per inserire un documento è possibile invocare, al posto del metodo insert, il metodo save nello stesso modo appena visto. A differenza del metodo insert, se il documento fosse stato precedentemente prelevato dal database, il metodo save avrebbe aggiornato il documento esistente. In altre parole il metodo insert corrisponde sempre ad un classico INSERT mentre il metodo save esegue un INSERT se il documento non esiste nel database, altrimenti un UPDATE.</p><p>Vediamo adesso uno degli aspetti più importanti dell&rsquo;interazione con un database ossia il recupero dei dati. Iniziamo con una ricerca priva di filtri, finalizzata alla lettura di tutti i documenti presenti nella collection.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$cursore <span style=color:#f92672>=</span> $collection<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>();

<span style=color:#66d9ef>foreach</span>($cursore <span style=color:#66d9ef>as</span> $documento) {
    <span style=color:#66d9ef>echo</span> $documento[<span style=color:#e6db74>&#39;nome&#39;</span>], <span style=color:#e6db74>&#39; &#39;</span>, $documento[<span style=color:#e6db74>&#39;cognome&#39;</span>], <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
}
</code></pre></div><p>Come è possibile desumere dal precedente esempio, il risultato dell’interrogazione, ovvero dell’invocazione del metodo find, è un <strong>cursore</strong>. Esso rappresenta un puntatore ai dati restituiti ed il suo movimento lungo il set di risultati, determinato dalle iterazioni del ciclo foreach, permetterà di accedere ad ogni singolo documento reperito. Questo infine può essere utilizzato come un normale array PHP per poterne trattare i risultati.</p><p>Vediamo adesso come effettuare una lettura dei documenti di una collection impiegando dei filtri. Ciò che nel mondo relazionale viene specificato nel corpo di una clausola WHERE di una query ora popola un array PHP da passare come parametro al metodo find().</p><p>Se ad esempio volessimo cercare i candidati di nome ‘Ugo’:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$query <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
    <span style=color:#e6db74>&#39;nome&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;Ugo&#39;</span>
);

$cursore <span style=color:#f92672>=</span> $collection<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($query);
</code></pre></div><p>Oppure, per recuperare i documenti in cui il voto di PHP risulta minore di 8 si può impostare $query in questa maniera:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$query <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
    <span style=color:#e6db74>&#39;PHP&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;$lt&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>8</span>)
);

$cursore <span style=color:#f92672>=</span> $collection<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>($query);
</code></pre></div><p>Quindi, in generale, i filtri di una query saranno specificati in un array che avrà come elementi i nomi dei campi da sottoporre a valutazione. Ad essi sono associate le condizioni da verificare. Gli operatori, come $lt che ha il significato di “minore di”, dovranno essere specificati come chiavi di un array a cui sarà associato l&rsquo;operando di confronto.</p><p>Ovviamente esistono operatori in grado di descrivere ogni casistica, ad esempio $gte sta per “maggiore o uguale”, $gt per “maggiore”, ecc.. Si faccia attenzione all’utilizzo dei singoli apici per definire gli operatori. Questi infatti, avendo in testa il simbolo $, possono essere confusi da PHP come variabili e sostituiti con il loro valore se inseriti in stringhe definite con i doppi apici.</p><p>Il meccanismo di definizione delle condizioni appena visto può essere usato anche per effettuare aggiornamenti e cancellazioni in una collection.</p><p>Vediamo ad esempio come cancellare tutti i documenti dei candidati che conoscono il Python</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$query <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(
    <span style=color:#e6db74>&#39;Python&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;$exists&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>true</span>)
);

$collection<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>remove</span>($query);
</code></pre></div><p>Per cancellare i documenti abbiamo usato il metodo remove passando la condizione nello stesso modo visto per effettuare le ricerche.</p><p>Prima di concludere accenniamo alle modalità di aggiornamento dei documenti. Abbiamo già detto che se preleviamo un documento, ad esempio con il metodo find, e ne modifichiamo i dati, possiamo poi salvare le modifiche effettuate con il metodo save. Grazie al metodo update è invece possibile aggiornare, sia nei contenuti che nella struttura, tutti i documenti che rispondono ad un particolare criterio. Date le sue potenzialità, l’uso di questo metodo è piuttosto complesso e la sua descrizione esula da questo articolo introduttivo.</p><hr><h2 id=conclusioni>Conclusioni</h2><p>In questo articolo abbiamo affrontato solo una piccola parte di tutto ciò che si può imparare su MongoDB e la sua interazione con un linguaggio versatile come PHP ma è quanto basta per poterne avviare lo studio.</p><p>La domanda che potrebbe venire in mente a questo punto è: “devo iniziare a rinunciare ai database relazionali e convertire le mie applicazioni al NoSQL?”</p><p>Sicuramente il nodo della questione verte sulla presenza o meno di una strutturazione dei dati. Al momento la migliore delle risposte che si può dare è quindi un&rsquo;ulteriore domanda: “quanto sono intrinsecamente strutturati i dati che devo gestire?”.</p><p>Finché l&rsquo;organizzazione dei dati in un modello relazionale appare naturale, i database tradizionali e le potenzialità di filtro ed aggregazione che offre SQL sono ancora imprescindibili. Viceversa la flessibilità propria di una soluzione orientata ai documenti può risultare determinante alla buona realizzazione di un progetto.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/database/ rel=tag>database</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mongodb/ rel=tag>MongoDB</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/utilizzare-il-filtro-antispam-di-akismet-con-php/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Utilizzare il filtro antispam di Akismet con PHP</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//giovannitomasicchio-it.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>