<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Utilizzare il filtro antispam di Akismet con PHP - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Proteggere uno script PHP per l'invio dei commenti utilizzando il filtro antispam di Akismet"><meta property="og:title" content="Utilizzare il filtro antispam di Akismet con PHP"><meta property="og:description" content="Proteggere uno script PHP per l'invio dei commenti utilizzando il filtro antispam di Akismet"><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/articoli/utilizzare-il-filtro-antispam-di-akismet-con-php/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2010-10-19T20:34:51+00:00"><meta property="article:modified_time" content="2010-10-19T20:34:51+00:00"><meta itemprop=name content="Utilizzare il filtro antispam di Akismet con PHP"><meta itemprop=description content="Proteggere uno script PHP per l'invio dei commenti utilizzando il filtro antispam di Akismet"><meta itemprop=datePublished content="2010-10-19T20:34:51+00:00"><meta itemprop=dateModified content="2010-10-19T20:34:51+00:00"><meta itemprop=wordCount content="719"><meta itemprop=keywords content="Zend Framework,WordPress,email,UTF-8,XML,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Utilizzare il filtro antispam di Akismet con PHP"><meta name=twitter:description content="Proteggere uno script PHP per l'invio dei commenti utilizzando il filtro antispam di Akismet"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Utilizzare il filtro antispam di Akismet con PHP</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2010-10-19T20:34:51Z>19 October 2010</time></div></div></header><div class="content post__content clearfix"><p><a href=http://akismet.com/>Akismet</a> è un servizio di filtraggio dello spam offerto dalla <a href=http://automattic.com/>Automattic</a>, l&rsquo;azienda maggiormente impegnata nello sviluppo di Wordpress. In questo articolo vedremo come invocare Akismet nei nostri script PHP per ricevere una valutazione sulla bontà dei commenti inviati dagli utenti attraverso un classico form HTML.</p><p>Il servizio di filtraggio di Akismet è gratuito per utilizzo personale, previa registrazione a <a href=http://akismet.com/personal/>questo indirizzo</a>. Completata la registrazione si riceverà via mail un codice personale che, come vedremo negli esempi tra breve, servirà per avere accesso al servizio.</p><p>La comunicazione tra Akismet ed il nostro script PHP deve avvenire via rete, fortunatamente non dobbiamo preoccuparci dei dettagli di tale interazione poiché sono disponibili due classi PHP che ne nascondono la complessità.</p><p>Iniziamo con la classe PHP5 Akismet, scaricabile a <a href=http://www.achingbrain.net/stuff/php/akismet>questo indirizzo</a>. Per vederla in azione prepariamo prima un form col quale un ipotetico utente può inviare un commento al nostro sito.</p><p><strong>- form.htm</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;

&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;it-it&quot; lang=&quot;it-it&quot; dir=&quot;ltr&quot;&gt;
   &lt;head&gt;
       &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;/&gt;
       &lt;title&gt;Test Akismet&lt;/title&gt;
   &lt;/head&gt;
   &lt;body&gt;
       &lt;form method=&quot;post&quot; action=&quot;form.php&quot; &gt;
           &lt;fieldset&gt;
               &lt;legend&gt;Invia un commento&lt;/legend&gt;
               &lt;label&gt;Nome:&lt;br /&gt;
                   &lt;input type=&quot;text&quot; name=&quot;nome&quot; /&gt;
               &lt;/label&gt;
               &lt;br /&gt;
               &lt;label&gt;Email:&lt;br /&gt;
                   &lt;input type=&quot;text&quot; name=&quot;email&quot; /&gt;
               &lt;/label&gt;
               &lt;br /&gt;
               &lt;label&gt;Sito web:&lt;br /&gt;
                   &lt;input type=&quot;text&quot; name=&quot;url&quot; /&gt;
               &lt;/label&gt;
               &lt;br /&gt;
               &lt;label&gt;Commento:&lt;br /&gt;
                   &lt;textarea cols=&quot;20&quot; rows=&quot;4&quot; name=&quot;commento&quot;&gt;&lt;/textarea&gt;
               &lt;/label&gt;
               &lt;br /&gt;
               &lt;input type=&quot;submit&quot; name=&quot;invia&quot; value=&quot;Invia&quot; /&gt;
           &lt;/fieldset&gt;
       &lt;/form&gt;        
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><p>Nonostante il form sia molto semplice contiene i classici campi di un modulo di commenti: nome, email e URL dell’utente, testo del messaggio.</p><p>Passiamo quindi a vedere come utilizzare la classe PHP5 Akismet.</p><p><strong>- form.php</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
&lt;?php
include 'Akismet.class.php';

// mettere qui il proprio codice Akismet
$codice_akismet = '************';

// impostare l'URL del proprio sito
$url_sito = 'http://www.miosito.it';

$akismet = new Akismet($url_sito, $codice_akismet);

$akismet-&gt;setCommentAuthor($_POST['nome']);
$akismet-&gt;setCommentAuthorEmail($_POST['email']);
$akismet-&gt;setCommentAuthorURL($_POST['url']);
$akismet-&gt;setCommentContent($_POST['commento']);
$akismet-&gt;setPermalink('http://www.miosito.it/articolo-da-commentare');

if ($akismet-&gt;isCommentSpam()) {
   echo 'Il commento non è stato approvato!';
} else {
   echo 'Il commento è stato approvato';
}

</code></pre><p>Lo script PHP si apre con l’inclusione della classe Akismet.class.php, responsabile della comunicazione con il filtro antispam. Nella variabile $codice_akismet viene conservato il codice personale di Akismet di cui abbiamo parlato all’inizio. Oltre al codice, per creare un oggetto Akismet è necessario passare al costruttore anche l’URL del nostro sito.</p><p>Le successive istruzioni permettono di specificare i dati inseriti dall’utente nel form (nome, email e URL dell’utente e testo del commento) ed in più l’URL della pagina che riceve il commento (che quindi cambia da pagina a pagina!).</p><p>Infine richiamando il metodo isCommentSpam() è possibile richiedere la valutazione del filtro antispam di Akismet sui dati precedentemente impostati. Se tale metodo restituisce <em>true</em> allora allora si trattava di spam.</p><p>La classe PHP5 Akismet, oltre alla verifica dei commenti, permette anche di segnalare ad Akismet un messaggio di spam, semplicemente sostituendo nello script precedente la chiamata al metodo $akismet->isCommentSpam() con $akismet->submitSpam(). Se invece Akismet ha erroneamente valutato un commento come spam, possiamo segnalare il falso positivo utilizzando il metodo $akismet->submitHam().</p><p>Nella prossima pagina vedremo come invocare il filtro antispam di Akismet utilizzando lo Zend Framework.</p><hr><p>Coloro che utilizzano lo Zend Framework per realizzare il proprio sito, o che semplicemente hanno lo Zend Framework installato sul proprio server, possono evitare di scaricare la classe PHP5 Akismet utilizzata nell’esempio precedente ed impiegare la classe <a href=http://framework.zend.com/manual/en/zend.service.akismet.html>Zend_Service_Akismet</a>. Vediamo quindi come realizzare lo script PHP, lasciando il form HTML inalterato.</p><p><strong>- form.php</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
&lt;?php
set_include_path(get_include_path() . PATH_SEPARATOR . 'C:\Program Files (x86)\Zend\ZendServer\share\ZendFramework\library');

require_once 'Zend/Service/Akismet.php';

// mettere qui il proprio codice Akismet
$codice_akismet = '************';

// impostare l'URL del proprio sito
$url_sito = 'http://www.miosito.it';

$akismet = new Zend_Service_Akismet($codice_akismet, $url_sito);

$data = array(
   'user_ip' =&gt; $_SERVER['REMOTE_ADDR'],
   'user_agent' =&gt; $_SERVER['HTTP_USER_AGENT'],
   'referrer' =&gt; $_SERVER['HTTP_REFERER'],
   'permalink' =&gt; 'http://www.miosito.it/articolo-da-commentare',
   'comment_type' =&gt; 'comment',
   'comment_author' =&gt; $_POST['nome'],
   'comment_author_email' =&gt; $_POST['email'],
   'comment_author_url' =&gt; $_POST['url'],
   'comment_content' =&gt; $_POST['commento']
);

if ($akismet-&gt;isSpam($data)) {
   echo 'Il commento non è stato approvato!';
} else {
   echo 'Il commento è stato approvato';
}
</code></pre><p>L’utilizzo di Zend_Service_Akismet non presenta particolari difficoltà. Similmente a quanto visto nella pagina precedente, lo script di esempio è diviso in tre sezioni:</p><ol><li>inizializzazione dell’oggetto Zend_Service_Akismet, responsabile della comunicazione con il filtro antispam, attraverso l’impiego del codice Akismet e dell’URL del proprio sito;</li><li>raccolta delle informazioni riguardanti il commento da sottoporre al filtro;</li><li>interrogazione del servizio di Akismet e verifica della risposta ottenuta.</li></ol><p>Anche con Zend_Service_Akismet è possibile segnalare un messaggio di spam ad Akismet, utilizzando il metodo $akismet->submitSpam($data), oppure segnalare un falso positivo utilizzando $akismet->submitHam($data).</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/zend-framework/ rel=tag>Zend Framework</a></li><li class=tags__item><a class="tags__link btn" href=/tags/wordpress/ rel=tag>WordPress</a></li><li class=tags__item><a class="tags__link btn" href=/tags/email/ rel=tag>email</a></li><li class=tags__item><a class="tags__link btn" href=/tags/utf-8/ rel=tag>UTF-8</a></li><li class=tags__item><a class="tags__link btn" href=/tags/xml/ rel=tag>XML</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/installare-php/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Installare PHP</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/introduzione-all%27utilizzo-di-mongodb-in-php/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Introduzione all'utilizzo di MongoDB in PHP</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>