<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Upload di un file con CURL - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Script PHP per upload con CURL"><meta property="og:title" content="Upload di un file con CURL"><meta property="og:description" content="Script PHP per upload con CURL"><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/articoli/upload-di-un-file-con-curl/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2006-06-15T17:21:06+00:00"><meta property="article:modified_time" content="2006-06-15T17:21:06+00:00"><meta itemprop=name content="Upload di un file con CURL"><meta itemprop=description content="Script PHP per upload con CURL"><meta itemprop=datePublished content="2006-06-15T17:21:06+00:00"><meta itemprop=dateModified content="2006-06-15T17:21:06+00:00"><meta itemprop=wordCount content="445"><meta itemprop=keywords content="FTP,HTTPS,upload,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Upload di un file con CURL"><meta name=twitter:description content="Script PHP per upload con CURL"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/contatti/><span class=menu__text>Contatti</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Upload di un file con CURL</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2006-06-15T17:21:06Z>15 June 2006</time></div></div></header><div class="content post__content clearfix"><p><strong>CURL</strong> (Client URL Library) è una estensione di PHP che fornisce l&rsquo;accesso alle funzioni della libreria libcurl. Queste funzioni permettono ad uno script di connettersi e comunicare con diversi tipi di server, adottando protocolli quali HTTP, HTTPS, FTP, TELNET, ecc.</p><p>Per utilizzare CURL gli utenti Windows devono abilitare il caricamento dell&rsquo;estensione <strong>php_curl.dll</strong> agendo sul php.ini (basta eliminare il punto e virgola dalla riga <em>;extension=php_curl.dll</em>).</p><p>Numerosi sono i possibili utilizzi di CURL. Di seguito vedremo come sia possibile inviare un file dati.txt da uno script mittente.php ad un ulteriore script destinatario.php. La trasmissione avverrà attraverso il metodo POST dell&rsquo;HTTP, pertanto sarà come effettuare l&rsquo;upload di un file. Questa volta però il mittente non sarà il browser ma lo script mittente.php, grazie proprio alle funzioni CURL.</p><p>Ecco il listato dello script mittente.php, abbondantemente commentato. Si noti come nella riga 4 per specificare il nome del file da trasmettere sia stato usato il carattere @. In questo modo CURL sa che il campo &lsquo;file_dati&rsquo; dell&rsquo;ipotetico form che stiamo inviando non contiene la stringa &ldquo;C:\dati.txt&rdquo; bensì il file C:\dati.txt.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#75715e>// preparo l&#39;array che conterrà i dati da inviare via POST
</span><span style=color:#75715e>// in questo caso c&#39;è solo il file da trasmettere
</span><span style=color:#75715e></span>$dati_post[<span style=color:#e6db74>&#39;file_dati&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;@C:\dati.txt&#34;</span>;

<span style=color:#75715e>// inizializzo la sessione CURL
</span><span style=color:#75715e></span>$ch <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>();

<span style=color:#75715e>// imposto l&#39;URL dello script destinatario
</span><span style=color:#75715e></span><span style=color:#a6e22e>curl_setopt</span>($ch, <span style=color:#a6e22e>CURLOPT_URL</span>, <span style=color:#e6db74>&#34;http://localhost/destinatario.php&#34;</span> );

<span style=color:#75715e>// indico il tipo di comunicazione da effettuare (POST)
</span><span style=color:#75715e></span><span style=color:#a6e22e>curl_setopt</span>($ch, <span style=color:#a6e22e>CURLOPT_POST</span>, <span style=color:#66d9ef>true</span> );

<span style=color:#75715e>// indico i dati da inviare attraverso POST
</span><span style=color:#75715e></span><span style=color:#a6e22e>curl_setopt</span>($ch, <span style=color:#a6e22e>CURLOPT_POSTFIELDS</span>, $dati_post);

<span style=color:#75715e>// specifico che la funzione curl_exec dovrà restituire l&#39;output
</span><span style=color:#75715e>// prodotto dall&#39;URL contattato (destinatario.php)
</span><span style=color:#75715e>// invece di inviarlo direttamente al browser
</span><span style=color:#75715e></span><span style=color:#a6e22e>curl_setopt</span>($ch, <span style=color:#a6e22e>CURLOPT_RETURNTRANSFER</span>, <span style=color:#66d9ef>true</span>);

<span style=color:#75715e>// eseguo la connessione e l&#39;invio dei dati e salvo in
</span><span style=color:#75715e>// $postResult l&#39;output prodotto dall&#39;URL contattato
</span><span style=color:#75715e></span>$postResult <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_exec</span>($ch);

<span style=color:#75715e>// se ci sono stati degli errori mostro un messaggio esplicativo
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>curl_errno</span>($ch)) {
   <span style=color:#66d9ef>print</span> <span style=color:#a6e22e>curl_error</span>($ch);
}

<span style=color:#75715e>// chiudo la sessione CURL
</span><span style=color:#75715e></span><span style=color:#a6e22e>curl_close</span>($ch);

<span style=color:#75715e>// mostro l&#39;output prodotto da destinatario.php
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> $postResult;
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>destinatario.php è invece un semplicissimo script che si occupa esclusivamente di salvare il file ricevuto da mittente.php. In caso di utilizzo reale dello script sarebbe opportuno inserire una serie di controlli per verificare se il processo di upload è stato eseguito correttamente, verifiche non necessarie ai fini di questo esempio.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#75715e>// provo a salvare in &#34;dati_ricevuti.txt&#34; il file ricevuto
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>move_uploaded_file</span>($_FILES[<span style=color:#e6db74>&#39;file_dati&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>], <span style=color:#e6db74>&#39;dati_ricevuti.txt&#39;</span>))
{
   <span style=color:#75715e>// se il salvataggio è andato a buon fine
</span><span style=color:#75715e></span>   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Dati ricevuti con successo</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
}
<span style=color:#66d9ef>else</span>
{
   <span style=color:#75715e>// se c&#39;è stato un probela
</span><span style=color:#75715e></span>   <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;ERRORE! Problema nella ricezione dei dati&#34;</span>;
}
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>Per concludere è importante ricordare che questo tipo di trasmissione è soggetto a i vincoli imposti dal server web ricevente, in particolare ai limiti di dimensione massima del file (direttiva <em>upload_max_filesize</em> del php.ini).</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/ftp/ rel=tag>FTP</a></li><li class=tags__item><a class="tags__link btn" href=/tags/https/ rel=tag>HTTPS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/upload/ rel=tag>upload</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/combattere-lo-spam-con-tecniche-captcha/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Combattere lo spam con tecniche CAPTCHA</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/controllare-la-validita-di-una-email/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Controllare la validità di una email</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//giovannitomasicchio-it.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>