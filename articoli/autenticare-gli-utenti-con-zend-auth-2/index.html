<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Autenticare gli utenti con Zend_Auth - 2 - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Creare un sistema di login in PHP con Zend_Auth utilizzando Zend_Auth_Adapter_DbTable per l'accesso ala database"><meta property="og:title" content="Autenticare gli utenti con Zend_Auth - 2"><meta property="og:description" content="Creare un sistema di login in PHP con Zend_Auth utilizzando Zend_Auth_Adapter_DbTable per l'accesso ala database"><meta property="og:type" content="article"><meta property="og:url" content="https://www.giovannitomasicchio.it/articoli/autenticare-gli-utenti-con-zend-auth-2/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2007-09-15T09:29:38+00:00"><meta property="article:modified_time" content="2007-09-15T09:29:38+00:00"><meta itemprop=name content="Autenticare gli utenti con Zend_Auth - 2"><meta itemprop=description content="Creare un sistema di login in PHP con Zend_Auth utilizzando Zend_Auth_Adapter_DbTable per l'accesso ala database"><meta itemprop=datePublished content="2007-09-15T09:29:38+00:00"><meta itemprop=dateModified content="2007-09-15T09:29:38+00:00"><meta itemprop=wordCount content="1255"><meta itemprop=keywords content="database,Zend Framework,MySQL,crittografia,CSS,exception,XML,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Autenticare gli utenti con Zend_Auth - 2"><meta name=twitter:description content="Creare un sistema di login in PHP con Zend_Auth utilizzando Zend_Auth_Adapter_DbTable per l'accesso ala database"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div><div class=logo__tagline>not just code monkeys</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li><li class=menu__item><a class=menu__link href=/ricerca/><span class=menu__text>Ricerca</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Autenticare gli utenti con Zend_Auth - 2</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2007-09-15T09:29:38Z>15 September 2007</time></div></div></header><div class="content post__content clearfix"><h3 id=zend_auth_adapter_dbtable>Zend_Auth_Adapter_DbTable</h3><p>Nel precedente articolo abbiamo analizzato i diversi componenti che concorrono alla realizzazione del sistema di autenticazione utente presente nello Zend Framework. In particolare abbiamo visto come il controllo delle credenziali dell&rsquo;utente avviene grazie ad una classe detta Adapter. Tra gli Adapter già presenti nello Zend Framework vi è <strong>Zend_Auth_Adapter_DbTable</strong> che può essere usato per confrontare lo username e la password forniti dall&rsquo;utente con quelli memorizzati in una tabella di un database.</p><p>Per accedere al database lo Zend_Auth_Adapter_DbTable necessita di una connessione al database, ovvero di uno Zend_Db_Adapter, oggetto che deve essere fornito direttamente al costruttore della classe. Gli ulteriori parametri per configurare Zend_Auth_Adapter_DbTable sono:</p><ul><li><strong>tableName</strong>: il nome della tabella del database che contiene username e password di tutti gli utenti, utilizzate per la verifica delle credenziali durante il login.</li><li><strong>identityColumn</strong>: il nome della colonna della tabella del database che contiene l&rsquo;username degli utenti registrati.</li><li><strong>credentialColumn</strong>: il nome della colonna che contiene la password degli utenti.</li><li><strong>credentialTreatment</strong>: indica un eventuale sistema utilizzato per oscurare le password all&rsquo;interno del database (crittografica, hash, ecc.). Ad esempio, se in un database MySQL vengono conservati gli hash MD5 delle password bisogna specificare &lsquo;MD5(?)&rsquo;. Si noti che credentialTreatment non fa riferimento ad una funzione PHP bensì ad una funzione del database impiegato.</li></ul><p>Lo username e la password da verificare vengono fornite all&rsquo;Adapter attraverso i metodi <strong>setIdentity($username)</strong> e <strong>setCredential($password)</strong>. Come per qualsiasi Adapter, il metodo authenticate() effettua il controllo di questi dati e restituisce un oggetto di tipo Zend_Auth_Result che, oltre a contenere l&rsquo;esito della procedura, contiene anche lo username dell&rsquo;utente. Se si procede con una autenticazione indiretta (si ricordi quanto detto nel precedente articolo) questa sarà l&rsquo;unica informazione che Zend_Auth conserverà nello Storage.</p><p>Spesso però è conveniente rendere persistenti ulteriori informazioni relative all&rsquo;utente loggato (ad esempio user_id, data ultimo accesso, nome da mostrare, ecc.) e alcune di queste informazioni risiedono proprio sullo stesso record della tabella utenti utilizzata per l&rsquo;autenticazione appena effettuata. Per questa ragione Zend_Auth_Adapter_DbTable fornisce il metodo <strong>getResultRowObject()</strong> per recuperare anche le altre informazioni presenti nel record della tabella utenti. Effettuando una autenticazione indiretta potremo memorizzare tali informazioni nello Storage di Zend_Auth.</p><p>getResultRowObject() permette anche di recuperare solo alcune informazioni dal record della tabella. Se ad esempio vogliamo recuperare solo i campi &ldquo;campo1&rdquo; e &ldquo;campo2&rdquo; bisogna procedere in questo modo:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$my_auth_adapter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResultRowObject</span>(<span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;campo1&#39;</span>, <span style=color:#e6db74>&#39;campo2&#39;</span>));
</code></pre></div><p>Se invece vogliamo recuperare tutti i campi tranne &ldquo;campo3&rdquo; e &ldquo;campo4&rdquo;:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$my_auth_adapter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResultRowObject</span>(<span style=color:#66d9ef>null</span>, <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;campo3&#39;</span>, <span style=color:#e6db74>&#39;campo4&#39;</span>));
</code></pre></div><hr><h3 id=applicazione-di-esempio>Applicazione di esempio</h3><p>Nelle pagine che seguono realizzeremo una piccola applicazione per vedere all&rsquo;opera il componente Zend_Auth ed applicare in un caso concreto alcune delle tecniche illustrate in questo e nel precedente articolo. L&rsquo;applicazione è costituita da un unico Controller, IndexController, e da un unico template index.phtml che realizza un semplice form di login. Ad autenticazione avvenuta, con lo stesso template mostreremo un messaggio di benvenuto ed un link per effettuare il logout. L&rsquo;ErrorController ed il relativo template non saranno realizzati.</p><p>L&rsquo;Adapter impiegato è lo Zend_Auth_Adapter_DbTable che utilizza una connessione a MySQL, creata nel file di bootstrap, ed una tabella di nome &ldquo;users&rdquo; che è possibile creare con le seguenti query:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>`</span>users<span style=color:#f92672>`</span> (
  <span style=color:#f92672>`</span>user_id<span style=color:#f92672>`</span> int(<span style=color:#ae81ff>11</span>) <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span> auto_increment,
  <span style=color:#f92672>`</span>user_name<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>`</span>password<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>`</span>nome<span style=color:#f92672>`</span> varchar(<span style=color:#ae81ff>32</span>) <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#66d9ef>PRIMARY</span> <span style=color:#66d9ef>KEY</span>  (<span style=color:#f92672>`</span>user_id<span style=color:#f92672>`</span>)
);


<span style=color:#66d9ef>insert</span> <span style=color:#66d9ef>into</span> <span style=color:#f92672>`</span>users<span style=color:#f92672>`</span> (<span style=color:#f92672>`</span>user_name<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>password<span style=color:#f92672>`</span>, <span style=color:#f92672>`</span>nome<span style=color:#f92672>`</span>) <span style=color:#66d9ef>values</span>(<span style=color:#e6db74>&#39;mario76&#39;</span>,<span style=color:#e6db74>&#39;525d5d4f0cfb94d045c48971aa1aa974&#39;</span>,<span style=color:#e6db74>&#39;mario rossi&#39;</span>);
</code></pre></div><p>La query di inserimento è utile per popolare la tabella degli utenti in modo da poter subito provare l&rsquo;applicazione effettuando il login conusername &ldquo;mario76&rdquo; e password &ldquo;segreto&rdquo;, memorizzata con il suo hash MD 5. Non verranno realizzate pagine per la creazione degli utenti, operazione che viene lasciata al lettore che potrà prendere spunto daltutorial sullo Zend Framework.</p><p>Potete scaricare tutti gli script realizzati da <a href=/download/ZF-auth.zip>questo link</a>.</p><hr><h3 id=il-file-di-bootstrap>Il file di bootstrap</h3><p>Il file di bootstrap utilizzato per questa semplice applicazione non contiene importanti variazioni rispetto a quello analizzato in dettaglio nel <a href=/articoli/zend-framework/zend-framework-tutorial-1/>tutorial sullo Zend Framework</a> al quale rimando per eventuali approfondimenti.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#a6e22e>set_include_path</span>(<span style=color:#a6e22e>get_include_path</span>()<span style=color:#f92672>.</span><span style=color:#a6e22e>PATH_SEPARATOR</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;C:\Programmi\ZendFramework\library&#39;</span>);

<span style=color:#66d9ef>require_once</span>(<span style=color:#e6db74>&#39;Zend/Loader.php&#39;</span>);

<span style=color:#a6e22e>Zend_Loader</span><span style=color:#f92672>::</span><span style=color:#a6e22e>registerAutoload</span>();

<span style=color:#a6e22e>date_default_timezone_set</span>(<span style=color:#e6db74>&#39;Europe/Rome&#39;</span>);

<span style=color:#66d9ef>try</span> {
   $db <span style=color:#f92672>=</span> <span style=color:#a6e22e>Zend_Db</span><span style=color:#f92672>::</span><span style=color:#a6e22e>factory</span>(<span style=color:#e6db74>&#39;Pdo_Mysql&#39;</span>, <span style=color:#66d9ef>array</span>(
   <span style=color:#e6db74>&#39;host&#39;</span>     <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;localhost&#39;</span>,
   <span style=color:#e6db74>&#39;username&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;root&#39;</span>,
   <span style=color:#e6db74>&#39;password&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;secret&#39;</span>,
   <span style=color:#e6db74>&#39;dbname&#39;</span>   <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;ZF-auth&#39;</span>
   ));

   $db<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getConnection</span>();
} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Zend_Db_Adapter_Exception</span> $e) {
   <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Zend_Db_Adapter_Exception: &#34;</span><span style=color:#f92672>.</span>$e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>Zend_Exception</span> $e) {
   <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#34;Zend_Exception&#34;</span><span style=color:#f92672>.</span>$e<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessage</span>());
}

<span style=color:#a6e22e>Zend_Registry</span><span style=color:#f92672>::</span><span style=color:#a6e22e>set</span>(<span style=color:#e6db74>&#39;db&#39;</span>, $db);

<span style=color:#a6e22e>define</span>(<span style=color:#e6db74>&#39;BASE_URL&#39;</span>, <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;index.php&#39;</span>,<span style=color:#e6db74>&#39;&#39;</span>,$_SERVER[<span style=color:#e6db74>&#39;PHP_SELF&#39;</span>]));
<span style=color:#a6e22e>Zend_Controller_Front</span><span style=color:#f92672>::</span><span style=color:#a6e22e>run</span>(<span style=color:#e6db74>&#39;controllers&#39;</span>);
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><hr><h3 id=indexcontroller>IndexController</h3><p>Considerato lo scopo didattico di questa applicazione e senza perdere di generalità, si è scelto di implementare tutto il sistema di login e logout direttamente nell&rsquo;IndexController. Analizziamo il funzionamento delle diverse Action:</p><p><strong>indexAction</strong>: quando viene mostrata la pagina principale di login (nel nostro caso si tratta dell&rsquo;unica pagina realizzata) dobbiamo semplicemente passare al template i dati relativi ad un eventuale utente loggato. In questo modo il template potrà mostrare un messaggio di benvenuto personalizzato.</p><p><strong>loginAction</strong>: questa action viene invocata quando l&rsquo;utente effettua il submit del form di login. Per verificare le credenziali ricevute bisogna prima effettuare il setup di Zend_Auth_Adapter_DbTable. Dopo aver verificato che username e password non sono vuote, passiamo questi dati all&rsquo;Adapter e li verifichiamo chiamando authenticate(). Attraverso $result controlliamo l&rsquo;esito della procedura. In caso di errore mostreremo un messaggio. Se invece l&rsquo;utente viene riconosciuto memorizziamo nello Storage lo user_id ed il nome dell&rsquo;utente. La procedura si conclude con il redirect alla stessa pagina di login.</p><p><strong>logoutAction</strong>: viene invocata dall&rsquo;utente cliccando su un link &ldquo;logout&rdquo;. L&rsquo;operazione richiede semplicemente l&rsquo;esecuzione del metodo clearIdentity() di Zend_Auth.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>IndexController</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Zend_Controller_Action</span>
{
   <span style=color:#66d9ef>protected</span> $_flashMessenger <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>()
   {
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_helper</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getHelper</span>(<span style=color:#e6db74>&#39;FlashMessenger&#39;</span>);
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>messaggi</span> <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMessages</span>();
   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>indexAction</span>()
   {
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>view</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>identity</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Zend_Auth</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getIdentity</span>();
   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>loginAction</span>()
   {
       $db <span style=color:#f92672>=</span> <span style=color:#a6e22e>Zend_Registry</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;db&#39;</span>);

       $my_auth_adapter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Zend_Auth_Adapter_DbTable</span>($db, <span style=color:#e6db74>&#39;users&#39;</span>, <span style=color:#e6db74>&#39;user_name&#39;</span>, <span style=color:#e6db74>&#39;password&#39;</span>, <span style=color:#e6db74>&#39;MD5(?)&#39;</span>);

       $username <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_getParam</span>(<span style=color:#e6db74>&#39;username&#39;</span>));
       $password <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_getParam</span>(<span style=color:#e6db74>&#39;password&#39;</span>));

       <span style=color:#75715e>// non possiamo invocare authenticate() se username o password sono vuoti
</span><span style=color:#75715e></span>       <span style=color:#75715e>// altrimenti Zend_Auth_Adapter_DbTable solleva una eccezione
</span><span style=color:#75715e></span>       <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span>$username <span style=color:#f92672>||</span> <span style=color:#f92672>!</span> $password) {
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#39;Username o password non inserita&#39;</span>);
           $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
       }

       $my_auth_adapter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setIdentity</span>($username)<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setCredential</span>($password);

       $result <span style=color:#f92672>=</span> $my_auth_adapter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>authenticate</span>();

       <span style=color:#75715e>// dal codice contenuto nel risultato dell&#39;autenticazione recuperiamo l&#39;esito
</span><span style=color:#75715e></span>       <span style=color:#75715e>// potevamo usare semplicemente $result-&gt;isValid()
</span><span style=color:#75715e></span>       <span style=color:#66d9ef>switch</span> ($result<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getCode</span>()){
           <span style=color:#75715e>//Login riuscito.
</span><span style=color:#75715e></span>           <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Zend_Auth_Result</span><span style=color:#f92672>::</span><span style=color:#a6e22e>SUCCESS</span> <span style=color:#f92672>:</span>
               <span style=color:#75715e>// la verifica è andata a buon fine
</span><span style=color:#75715e></span>               <span style=color:#75715e>// dobbiamo quindi memorizzare i dati dell&#39;utente nello Storage di Zend_Auth (Zend_Auth_Storage_Session)
</span><span style=color:#75715e></span>               <span style=color:#75715e>// non memorizziamo tutti i dati del record della tabella relativa all&#39;utente ma solo quelli di nostro interesse
</span><span style=color:#75715e></span>                <span style=color:#a6e22e>Zend_Auth</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getStorage</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>write</span>($my_auth_adapter<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getResultRowObject</span>(<span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;user_id&#39;</span>, <span style=color:#e6db74>&#39;nome&#39;</span>)));

                <span style=color:#75715e>// per memorizzare tutti i dati del record, tranne la password
</span><span style=color:#75715e></span>                <span style=color:#75715e>//$this-&gt;_auth-&gt;getStorage()-&gt;write($adapter-&gt;getResultRowObject(null, &#39;password&#39;));
</span><span style=color:#75715e></span>               <span style=color:#66d9ef>break</span>;
               <span style=color:#75715e>//Username non trovato
</span><span style=color:#75715e></span>           <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Zend_Auth_Result</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FAILURE_IDENTITY_NOT_FOUND</span> <span style=color:#f92672>:</span>
               $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#39;Username non trovato&#39;</span>);
               <span style=color:#66d9ef>break</span>;
               <span style=color:#75715e>//Password non corretta
</span><span style=color:#75715e></span>           <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>Zend_Auth_Result</span><span style=color:#f92672>::</span><span style=color:#a6e22e>FAILURE_CREDENTIAL_INVALID</span> <span style=color:#f92672>:</span>
               $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#39;Password errata&#39;</span>);
               <span style=color:#66d9ef>break</span>;
               <span style=color:#75715e>//Errore sconosciuto
</span><span style=color:#75715e></span>           <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
               $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#39;Errore Sconosciuto&#39;</span>);
               <span style=color:#66d9ef>break</span>;
       }
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
   }

   <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>logoutAction</span>()
   {
       <span style=color:#75715e>// per effettuare il logout basta cancellare i dati dell&#39;utente corrente
</span><span style=color:#75715e></span>       <span style=color:#75715e>// memorizzati in Zend_Auth_Storage_Session
</span><span style=color:#75715e></span>       <span style=color:#75715e>// con il seguente metodo sarà lo Zend_Auth ad occuparsene
</span><span style=color:#75715e></span>       <span style=color:#a6e22e>Zend_Auth</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getInstance</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>clearIdentity</span>();
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_flashMessenger</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addMessage</span>(<span style=color:#e6db74>&#39;Log-out effettuato con successo.&#39;</span>);
       $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>_redirect</span>(<span style=color:#e6db74>&#39;/&#39;</span>);
   }
}
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><hr><h3 id=il-template>Il template</h3><p>Di seguito viene riportato l&rsquo;unico template presente nella nostra piccola applicazione web. Per gli utenti non ancora identificati è necessario mostrare il form di login mentre per gli utenti loggati bisogna mostrare un messaggio di benvenuto personalizzato ed un link per il logout. Questa distinzione viene realizzata con un semplice IF che interroga il metodo hasIdentity() di Zend_Auth. Si noti infine l&rsquo;utilizzo di $this->identity->nome per recuperare il nome dell&rsquo;utente corrente da mostrare nel messaggio di benvenuto.</p><p>Anche in questo caso si rimanda al tutorial sullo Zend Framework per i dettagli sulle altre funzioni presenti.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>html</span> <span style=color:#a6e22e>xmlns</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://www.w3.org/1999/xhtml&#34;</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;it&#34;</span> <span style=color:#a6e22e>xml</span><span style=color:#f92672>:</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;it&#34;</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>head</span><span style=color:#f92672>&gt;</span>
   <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>meta</span> <span style=color:#a6e22e>http</span><span style=color:#f92672>-</span><span style=color:#a6e22e>equiv</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Content-Type&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/html; charset=iso-8859-1&#34;</span> <span style=color:#f92672>/&gt;</span>
   <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>title</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Zend_Auth</span> <span style=color:#a6e22e>Tutorial</span><span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>title</span><span style=color:#f92672>&gt;</span>
   <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/css&#34;</span> <span style=color:#a6e22e>media</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;screen, handheld, print&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&lt;?php echo BASE_URL?&gt;main.css&#34;</span> <span style=color:#f92672>/&gt;</span>
<span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>head</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>body</span><span style=color:#f92672>&gt;</span>
   <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;page&#34;</span><span style=color:#f92672>&gt;</span>
       <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>h1</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Home</span> <span style=color:#a6e22e>page</span><span style=color:#f92672>&lt;/</span><span style=color:#a6e22e>h1</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>p</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;errore&#34;</span><span style=color:#f92672>&gt;&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#66d9ef>echo</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>escape</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>messaggi</span>[<span style=color:#ae81ff>0</span>])<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;?php if (!Zend_Auth::getInstance()-&gt;hasIdentity()): ?&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;form action=&#34;&lt;?php echo BASE_URL?&gt;index/login&#34; method=&#34;post&#34;&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;fieldset&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;legend&gt;Login&lt;/legend&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;p&gt;&lt;label&gt;Username:&lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;?php echo $this-&gt;formText(&#39;username&#39;)?&gt;&lt;/label&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;p&gt;&lt;label&gt;Password:&lt;br /&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;?php echo $this-&gt;formPassword(&#39;password&#39;)?&gt;&lt;/label&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;p&gt;&lt;?php echo $this-&gt;formSubmit(&#39;submit&#39;, &#39;Login&#39;)?&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/fieldset&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;/form&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;?php else: ?&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;p&gt;Benvenuto &lt;?php echo $this-&gt;escape($this-&gt;identity-&gt;nome)?&gt;&lt;/p&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;p&gt;&lt;a href=&#34;&lt;?php echo BASE_URL?&gt;index/logout&#34;&gt;log-out&lt;/a&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;?php endif; ?&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/div&gt;
</span><span style=color:#960050;background-color:#1e0010>   &lt;/body&gt;
</span><span style=color:#960050;background-color:#1e0010>&lt;/html&gt;
</span></code></pre></div></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/database/ rel=tag>database</a></li><li class=tags__item><a class="tags__link btn" href=/tags/zend-framework/ rel=tag>Zend Framework</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mysql/ rel=tag>MySQL</a></li><li class=tags__item><a class="tags__link btn" href=/tags/crittografia/ rel=tag>crittografia</a></li><li class=tags__item><a class="tags__link btn" href=/tags/css/ rel=tag>CSS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/exception/ rel=tag>exception</a></li><li class=tags__item><a class="tags__link btn" href=/tags/xml/ rel=tag>XML</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/autenticare-gli-utenti-con-zend-auth-1/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Autenticare gli utenti con Zend_Auth - 1</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/paginazione-dei-dati/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Paginazione dei dati</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>