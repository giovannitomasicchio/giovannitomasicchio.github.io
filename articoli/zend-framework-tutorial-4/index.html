<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Zend Framework Tutorial - 4 - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="I Controller dello Zend Framework"><meta property="og:title" content="Zend Framework Tutorial - 4"><meta property="og:description" content="I Controller dello Zend Framework"><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/articoli/zend-framework-tutorial-4/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2007-07-21T09:28:44+00:00"><meta property="article:modified_time" content="2007-07-21T09:28:44+00:00"><meta itemprop=name content="Zend Framework Tutorial - 4"><meta itemprop=description content="I Controller dello Zend Framework"><meta itemprop=datePublished content="2007-07-21T09:28:44+00:00"><meta itemprop=dateModified content="2007-07-21T09:28:44+00:00"><meta itemprop=wordCount content="1021"><meta itemprop=keywords content="database,Zend Framework,CSS,XML,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zend Framework Tutorial - 4"><meta name=twitter:description content="I Controller dello Zend Framework"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Zend Framework Tutorial - 4</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2007-07-21T09:28:44Z>21 July 2007</time></div></div></header><div class="content post__content clearfix"><h3 id=indexcontroller>IndexController</h3><p>Dopo aver analizzato la classe Model che gestisce tutta l&rsquo;interazione con il database, possiamo finalmente iniziare a vedere i Controller della nostra applicazione ed i template HTML associati. Abbiamo detto che i Controller sono classi costituite da Action, metodi che vengono automaticamente richiamati dal Front Controller per svolgere una particolare funzionalità del sito, associata ad un URL richiesto dall&rsquo;utente. Cosa ci aspettiamo di trovare quindi in una Action?</p><p>Generalmente una Action preleva eventuali dati presenti nella richiesta effettuata dall&rsquo;utente (come i dati GET e POST), richiama uno o più Model per interagire col database e mostra il risultato del suo operato caricando (implicitamente o esplicitamente) un template a cui passa i dati dinamici da visualizzare. Vediamo come queste operazioni vengono eseguite nell&rsquo;IndexController, responsabile della home page del sito. Di seguito viene riportato il codice completo.</p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
class IndexController extends Zend_Controller_Action
{
   public function indexAction()
   {
       $this-&gt;view-&gt;titoloPagina = 'Ultime news';

       $fm = $this-&gt;_helper-&gt;getHelper('FlashMessenger');
       $this-&gt;view-&gt;messaggi = $fm-&gt;getMessages();

       $news = new News();

       $this-&gt;view-&gt;news = $news-&gt;getAllNews();
   }
}
</code></pre><p>Analizziamo il codice riga per riga:</p><ul><li>riga 5: la stringa &lsquo;Ultime news&rsquo; viene assegnata alla variabile titoloPagina dell&rsquo;oggetto View. Questo oggetto, che ricordiamo si occupa della visualizzazione dei template HTML, viene automaticamente creato dallo Zend Framework ed è accessibile dal Controller attraverso la sua variabile $this->view. In questo modo il passaggio dei dati dal Controller alla View è semplicissimo, basta infatti assegnare i dati ad una variabile dell&rsquo;oggetto $this->view, ad esempio $this->view->nomeVariabile = $valore. Il template HTML che verrà poi richiamato da View vedrà tutte le variabili della View come proprie, quindi per recuperare tale valore accederà a $this->nomeVariabile.</li><li>riga 7: viene creato un oggetto <strong>FlashMessenger</strong>, un componente di supporto (Helper) del Controller nel quale è possibile conservare uno o più messaggi da mostrare all&rsquo;utente nelle successive pagine del sito. Questi messaggi vengono salvati automaticamente in sessione quindi il FlashMessenger può essere utilizzato da una Action che sta per effettuare il redirect ad un&rsquo;altra pagina e vuole che questa mostri un messaggio. Nella nostra applicazione questi messaggi vengono generati durante la gestione delle news (inserimento, modifica, cancellazione) e vengono visualizzati nella home page.</li><li>riga 8: l&rsquo;array dei messaggi conservati da precedenti Action nel FlashMessenger viene assegnato alla variabile $this->view->messaggi in modo che il template possa visualizzarli.</li><li>riga 10: viene istanziato il Model delle News.</li><li>riga 12: assegnamo alla variabile $this->view->news tutte le news che ci restituisce il Model in modo che il template possa visualizzarle.</li></ul><p>Come avrete notato, in indexAction non si fa riferimento a nessun template da mostrare. Questo perché lo Zend Framework di default, dopo aver richiamato una Action, carica automaticamente il template associato attraverso l&rsquo;oggetto View. In questo caso, poiché la Action si chiama <strong>index</strong>Action ed appartiene al controller <strong>Index</strong>Controller allora verrà richiamato il template view/scripts/<strong>index</strong>/<strong>index</strong>.phtml.</p><hr><h3 id=template-header-e-footer>template, header e footer</h3><p>Di seguito viene mostrato il contenuto del file index.phtml. Si tratta del template HTML associato alla home page del nostro sito, caricato automaticamente al termine dell&rsquo;esecuzione di indexAction dell&rsquo;IndexController. Sono presenti diverse istruzioni PHP ma tutte finalizzate a mostrare il contenuto dinamico, generalmente passato alla View dal Controller. In particolare l&rsquo;indexController fornisce alla View l&rsquo;array dei messaggi conservati nel FlashMessenger e l&rsquo;array delle news estratto dal DB. Questi dati sono accessibili nel template attraverso $this->messaggi e $this->news.</p><p>Il template utilizza anche 2 importanti funzioni della View:</p><ul><li><strong>$this->render(&lsquo;nome_template.phtml&rsquo;)</strong> serve ad includere nell&rsquo;attuale template un ulteriore template, operazione analoga al classico include() di PHP. In questo modo vengono caricati header.phtml e footer.phtml, i 2 template che costituiscono l&rsquo;intestazione ed il piè di pagina di tutte le pagine del nostro sito.</li><li><strong>$this->escape($stringa)</strong> serve a convertire i caratteri illeciti per una pagina HTML in entità HTML, come ad esempio i caratteri &lt; e >. L&rsquo;utilizzo di $this->escape al posto del classico html_special_chars è da preferire poiché il suo comportamento si adegua in maniera trasparente al set di caratteri impostato nella View.</li></ul><p><strong>index.phtml</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
&lt;?php echo $this-&gt;render('header.phtml'); ?&gt;
&lt;p class=&quot;errore&quot;&gt;&lt;?php echo $this-&gt;escape($this-&gt;messaggi[0])?&gt;&lt;/p&gt;
&lt;a href=&quot;&lt;?php echo BASE_URL?&gt;news/new/&quot;&gt;Inserisci una news&lt;/a&gt;
&lt;?php if ($this-&gt;news): ?&gt;
   &lt;?php foreach ($this-&gt;news as $news): ?&gt;
       &lt;div class=&quot;news&quot;&gt;
           &lt;h2&gt;&lt;a href=&quot;&lt;?php echo BASE_URL?&gt;news/view/id/&lt;?php echo $this-&gt;escape($news['news_id']) ?&gt;/&quot;&gt;&lt;?php echo $this-&gt;escape($news['titolo']) ?&gt;&lt;/a&gt;&lt;/h2&gt;
           &lt;div class=&quot;autore&quot;&gt;di &lt;?php echo $this-&gt;escape($news['autore']) ?&gt; | &lt;?php echo $this-&gt;escape($news['data']) ?&gt;&lt;/div&gt;
           &lt;div class=&quot;modifica&quot;&gt;
               &lt;a href=&quot;&lt;?php echo BASE_URL?&gt;news/edit/id/&lt;?php echo $this-&gt;escape($news['news_id']) ?&gt;/&quot;&gt;Modifica&lt;/a&gt;
               -
               &lt;a href=&quot;&lt;?php echo BASE_URL?&gt;news/delete/id/&lt;?php echo $this-&gt;escape($news['news_id']) ?&gt;/&quot;&gt;Cancella&lt;/a&gt;
           &lt;/div&gt;
           &lt;p class=&quot;testo&quot;&gt;&lt;?php echo nl2br($this-&gt;escape($news['testo_intro'])) ?&gt;&lt;/p&gt;
       &lt;/div&gt;
   &lt;?php endforeach; ?&gt;
&lt;?php else: ?&gt;
   &lt;p&gt;Nessuna news registrata.&lt;/p&gt;
&lt;?php endif; ?&gt;
&lt;?php echo $this-&gt;render('footer.phtml'); ?&gt;
</code></pre><p>Si noti come nel precedente template vengono costruiti i link che permettono all&rsquo;utente di visualizzare, inserire, modificare o cancellare una news. Viene utilizzata la costante BASE_URL come percorso comune a tutti gli URL, al quale viene accodato il nome del Controller (news) e della Action (new, view, edit e delete), secondo le convenzioni viste nei precedenti articoli, e se necessario un parametro &ldquo;id&rdquo; per identificare la news in questione. Il valore di tale parametro è fornito dal database e conservato nella variabile $news[&lsquo;news_id&rsquo;].</p><p>Ecco il codice contenuto nei template che costituiscono header e footer di tutte le pagine della nostra applicazione web. Si notino i tag &lt;title> e &lt;h1> valorizzati dal contenuto di $this->titoloPagina.</p><p><strong>header.phtml</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;

&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; lang=&quot;it&quot; xml:lang=&quot;it&quot;&gt;
&lt;head&gt;
   &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
   &lt;title&gt;&lt;?php echo $this-&gt;escape($this-&gt;titoloPagina)?&gt;&lt;/title&gt;
   &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; media=&quot;screen, handheld, print&quot; href=&quot;&lt;?php echo BASE_URL?&gt;main.css&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;div id=&quot;page&quot;&gt;
       &lt;h1&gt;&lt;?php echo $this-&gt;escape($this-&gt;titoloPagina)?&gt;&lt;/h1&gt;
</code></pre><p><strong>footer.phtml</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
&lt;/div&gt;
   &lt;/body&gt;
&lt;/html&gt;
</code></pre><hr><h3 id=errorcontroller>ErrorController</h3><p>ErrorController è il Controller che intercetta (tra le altre cose) eventuali errori del Front Controller, come ad esempio gli errori di &ldquo;pagina non trovata&rdquo;. La sua struttura e davvero molto semplice, in pratica si limita a dare un titolo esplicativo alla pagina. Il messaggio vero e proprio è invece conservato direttamente nel template associato (error.phtml), richiamato automaticamente grazie alla convenzione sui nomi dei file.</p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
&lt;?php
class ErrorController extends Zend_Controller_Action
{
   public function errorAction()
   {
       $this-&gt;view-&gt;titoloPagina = 'Pagina non trovata';
   }
}
?&gt;
</code></pre><p><strong>error.phtml</strong></p><pre><code>&lt;pre class=&quot;brush: php&quot;&gt;
&lt;?php echo $this-&gt;render('header.phtml'); ?&gt;
&lt;div class=&quot;testo&quot;&gt;Attensione! La pagina che stai cercando non esiste oppure è stata spostata.&lt;/div&gt;
&lt;br /&gt;
&lt;a href=&quot;&lt;?php echo BASE_URL?&gt;&quot;&gt;&amp;lt;&amp;lt; Home page&lt;/a&gt;
&lt;?php echo $this-&gt;render('footer.phtml'); ?&gt;
</code></pre><p>Nel prossimo ed ultimo articolo vedremo il funzionamento del NewsController, cuore della nostra applicazione realizzata con lo Zend Framework.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/database/ rel=tag>database</a></li><li class=tags__item><a class="tags__link btn" href=/tags/zend-framework/ rel=tag>Zend Framework</a></li><li class=tags__item><a class="tags__link btn" href=/tags/css/ rel=tag>CSS</a></li><li class=tags__item><a class="tags__link btn" href=/tags/xml/ rel=tag>XML</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/zend-framework-tutorial-3/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Zend Framework Tutorial - 3</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/zend-framework-tutorial-5/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>Zend Framework Tutorial - 5</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>