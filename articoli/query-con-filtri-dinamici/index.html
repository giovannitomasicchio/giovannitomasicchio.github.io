<!doctype html><html class=no-js lang=it><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Query con filtri dinamici - Giovanni Tomasicchio</title><script>(function(a,b){a[b]=a[b].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content="Tecniche per realizzare con MySQL una query con filtri dinamici."><meta property="og:title" content="Query con filtri dinamici"><meta property="og:description" content="Tecniche per realizzare con MySQL una query con filtri dinamici."><meta property="og:type" content="article"><meta property="og:url" content="https://giovannitomasicchio.github.io/articoli/query-con-filtri-dinamici/"><meta property="article:section" content="articoli"><meta property="article:published_time" content="2008-11-29T14:25:25+00:00"><meta property="article:modified_time" content="2008-11-29T14:25:25+00:00"><meta itemprop=name content="Query con filtri dinamici"><meta itemprop=description content="Tecniche per realizzare con MySQL una query con filtri dinamici."><meta itemprop=datePublished content="2008-11-29T14:25:25+00:00"><meta itemprop=dateModified content="2008-11-29T14:25:25+00:00"><meta itemprop=wordCount content="440"><meta itemprop=keywords content="database,MySQL,SQL,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Query con filtri dinamici"><meta name=twitter:description content="Tecniche per realizzare con MySQL una query con filtri dinamici."><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,regular,italic,600,600italic,700,700italic,800,800italic|Kaushan+Script:regular"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-525H86QENV"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-525H86QENV',{anonymize_ip:!1})}</script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Giovanni Tomasicchio" rel=home><div class="logo__item logo__text"><div class=logo__title>Giovanni Tomasicchio</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/><span class=menu__text>Home</span></a></li><li class=menu__item><a class=menu__link href=/articoli/><span class=menu__text>Articoli PHP</span></a></li><li class=menu__item><a class=menu__link href=/corsi/><span class=menu__text>Corsi</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Query con filtri dinamici</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2008-11-29T14:25:25Z>29 November 2008</time></div></div></header><div class="content post__content clearfix"><p>Capita spesso di dover realizzare una ricerca all&rsquo;interno del database secondo dei criteri che variano in base alle condizioni impostate dall&rsquo;utente. Supponiamo ad esempio di dover realizzare un <strong>motore di ricerca</strong> dei comuni italiani. L&rsquo;utente potra' specificare il nome del comune o parte di esso, inoltre potra' selezionare la regione o la provincia di appartenenza per restringere il campo di ricerca.</p><p>Poiché non vi è alcun obbligo di specificare tutti i criteri di ricerca, è necessario trovare un sistema per poter realizzare una query SQL che consideri solo le condizioni specificate dall&rsquo;utente ed ignori gli altri criteri. Una soluzione comunemente adottata consiste nel <strong>comporre dinamicamente lo statement SQL</strong> attraverso degli &ldquo;spezzoni&rdquo; di SQL da accodare l&rsquo;uno all&rsquo;altro in base all&rsquo;input dell&rsquo;utente. In questo modo potremo inserire nella clausola WHERE solo le condizioni realmente indicate dall&rsquo;utente.</p><p>Questa tecnica, sicuramente flessibile, ha però uno svantaggio, ovvero <strong>frammenta lo statement SQL</strong> in tante stringhe, rendendolo di difficile comprensione. In alternativa possiamo lasciare a MySQL il compito di <strong>ignorare le condizioni non specificate</strong> e considerare solo quelle realmente impostate dall&rsquo;utente. Vediamo uno statement SQL in grado di fare quanto appena detto.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#75715e>// tutti i comuni
</span><span style=color:#75715e></span>$nome_comune <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
$cod_provincia <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
$cod_regione <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;

<span style=color:#75715e>// i comuni che contengono il testo &#39;to&#39;
</span><span style=color:#75715e></span>$nome_comune <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;to&#39;</span>;
$cod_provincia <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
$cod_regione <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;

<span style=color:#75715e>// tutti i comuni del Piemonte
</span><span style=color:#75715e></span>$nome_comune <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
$cod_provincia <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
$cod_regione <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 1 = Piemonte
</span><span style=color:#75715e></span>
<span style=color:#75715e>// tutti i comuni della provincia di torino che contengono il testo &#39;to&#39;
</span><span style=color:#75715e></span>$nome_comune <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;to&#39;</span>;
$cod_provincia <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>; <span style=color:#75715e>// 1 = Torino
</span><span style=color:#75715e></span>$cod_regione <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;

$sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT * 
</span><span style=color:#e6db74>       FROM comune c, provincia p, regione r
</span><span style=color:#e6db74>       WHERE
</span><span style=color:#e6db74>          c.COD_PROVINCIA = p.COD_PROVINCIA AND
</span><span style=color:#e6db74>          p.COD_REGIONE = r.COD_REGIONE AND
</span><span style=color:#e6db74>          (&#39;</span><span style=color:#e6db74>$nome_comune</span><span style=color:#e6db74>&#39; = &#39;&#39; OR c.DENOMINAZIONE LIKE &#39;%</span><span style=color:#e6db74>$nome_comune</span><span style=color:#e6db74>%&#39;) AND
</span><span style=color:#e6db74>          (</span><span style=color:#e6db74>$cod_provincia</span><span style=color:#e6db74> = 0 OR p.COD_PROVINCIA = </span><span style=color:#e6db74>$cod_provincia</span><span style=color:#e6db74>) AND
</span><span style=color:#e6db74>          (</span><span style=color:#e6db74>$cod_regione</span><span style=color:#e6db74> = 0 OR r.COD_REGIONE = </span><span style=color:#e6db74>$cod_regione</span><span style=color:#e6db74>)
</span><span style=color:#e6db74>       ORDER BY c.DENOMINAZIONE&#34;</span>;
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>La query dell&rsquo;esempio parte dal presupposto che l&rsquo;utente può specificare il nome del comune (oppure lasciarlo &ldquo;in bianco&rdquo;), può selezionare con una casella di selezione &lt;select> il codice della regione di appartenenza (in caso contrario il codice sarà 0), ed infine sempre con una casella di selezione può scegliere la provincia di appartenenza (in caso contrario il codice sarà 0). Osservando le tre condizioni poste nella clausola WHERE noteremo che sono proprio la stringa vuota ed il codice 0 ad inibire il filtro associato.</p><p>Questo succede perché MySQL quando valuta una espressione del tipo <em>condizione_1 OR condizione_2</em>, se trova che la <em>condizione_1</em> è verificata evita di controllare anche la <em>condizione_2</em> poiché il risultato dell&rsquo;espressione sarà comunque <em>true</em>.</p><p>Se volete provare la query dell&rsquo;esempio potete staricare il database dei comuni italiani da <a href=/download/italia.zip>questo link</a>.</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/database/ rel=tag>database</a></li><li class=tags__item><a class="tags__link btn" href=/tags/mysql/ rel=tag>MySQL</a></li><li class=tags__item><a class="tags__link btn" href=/tags/sql/ rel=tag>SQL</a></li></ul></div></footer></article></main><nav class="pager flex"><div class="pager__item pager__item--prev"><a class=pager__link href=/articoli/ottenere-il-pagerank-di-google-con-php/ rel=prev><span class=pager__subtitle>«&#8201;Precedente</span><p class=pager__title>Ottenere il pagerank di Google con PHP</p></a></div><div class="pager__item pager__item--next"><a class=pager__link href=/articoli/iis-7-e-php-in-windows-vista-con-fastcgi/ rel=next><span class=pager__subtitle>Prossimo&#8201;»</span><p class=pager__title>IIS 7 e PHP in Windows Vista con FastCGI</p></a></div></nav></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Giovanni Tomasicchio.
<span class=footer__copyright-credits>Generato con <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> e il tema <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>